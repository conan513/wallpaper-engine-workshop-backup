/*!
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */

!function(e){function t(t){for(var n,i,l=t[0],s=t[1],c=t[2],d=0,h=[];d<l.length;d++)i=l[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&h.push(o[i][0]),o[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(u&&u(t);h.length;)h.shift()();return a.push.apply(a,c||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,l=1;l<r.length;l++){var s=r[l];0!==o[s]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={2:0},a=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;a.push([213,1,0,3,4]),r()}({11:function(e,t,r){"use strict";let n,o,a;r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return a})),function(e){e[e.VerticalBars=0]="VerticalBars",e[e.VerticalBlocks=1]="VerticalBlocks",e[e.VerticalWave=2]="VerticalWave",e[e.CircularBars=3]="CircularBars",e[e.CircularBlocks=4]="CircularBlocks",e[e.CircularWave=5]="CircularWave"}(n||(n={})),function(e){e[e.Bars=0]="Bars",e[e.Blocks=1]="Blocks",e[e.Wave=2]="Wave"}(o||(o={})),function(e){e[e.Bars=0]="Bars",e[e.Blocks=1]="Blocks",e[e.Wave=2]="Wave"}(a||(a={}))},114:function(e){e.exports=JSON.parse('{"schemecolor":{"value":"0 0 0"},"showDescriptions":{"value":false},"showAdvancedOptions":{"value":false},"showStats":{"value":false},"limitFps":{"value":true},"background_type":{"options":[{"value":"Color"},{"value":"Image"},{"value":"Css"},{"value":"Playlist"}],"value":"Color"},"background_color":{"value":"0 0.007843 0.035294"},"background_image":{},"background_css":{"value":"background: radial-gradient(ellipse at center, #0d0f16 0%,#030611 60%,#000105 100%);"},"background_playlist":{"mode":"ondemand"},"background_playlistTimer":{"value":1,"min":0.5,"max":24,"fraction":true,"step":0.5},"audioSamples_correct":{"value":true},"audioSamples_volumeGain":{"value":35,"min":-100,"max":100},"audioSamples_freqThreshold":{"value":0.1,"min":0,"max":10,"fraction":true,"step":0.1},"audioSamples_scale":{"options":[{"value":"Linear"},{"value":"Power"},{"value":"Exponential"},{"value":"Logarithm"},{"value":"Logarithm$Power"},{"value":"Gaussian"}],"value":"Logarithm"},"audioSamples_scale_Power_exponent":{"value":2,"min":0.2,"max":4,"fraction":true,"step":0.1},"audioSamples_scale_Exponential_base":{"value":2,"min":1.5,"max":3,"fraction":true,"step":0.1},"audioSamples_scale_Logarithm_base":{"value":2,"min":1.8,"max":3,"fraction":true,"step":0.1},"audioSamples_scale_Logarithm$Power_a":{"value":0.4,"min":0,"max":1,"fraction":true,"step":0.1},"audioSamples_scale_Logarithm$Power_base":{"value":3,"min":1.8,"max":5,"fraction":true,"step":0.1},"audioSamples_scale_Logarithm$Power_exponent":{"value":1.8,"min":0.2,"max":5,"fraction":true,"step":0.1},"audioSamples_scale_Gaussian_deviation":{"value":0.43,"min":0.01,"max":0.6,"fraction":true,"step":0.1},"audioSamples_scale_Gaussian_mean":{"value":0.92,"min":0,"max":1.2,"fraction":true,"step":0.1},"audioSamples_buffer":{"value":0.4,"min":0,"max":1,"fraction":true,"step":0.1},"audioSamples_normalize":{"value":false},"visualizer_type":{"options":[{"value":"VerticalBars"},{"value":"VerticalBlocks"},{"value":"VerticalWave"},{"value":"CircularBars"},{"value":"CircularBlocks"},{"value":"CircularWave"}],"value":"VerticalBars"},"visualizer_flipFrequencies":{"value":false},"visualizer_smoothing":{"value":38,"min":0,"max":100},"visualizer_color_responseType":{"options":[{"value":"None"},{"value":"Hue"},{"value":"Saturation"},{"value":"HsvBrightness"},{"value":"HslLightness"},{"value":"LabLightness"},{"value":"LabA"},{"value":"LabB"}],"value":"HsvBrightness"},"visualizer_color_responseProvider":{"options":[{"value":"Value"},{"value":"ValueNormalized"},{"value":"Change"},{"value":"ChangeAbsolute"}],"value":"ValueNormalized"},"visualizer_color_responseValueGain":{"value":1,"min":0.1,"max":5,"fraction":true,"step":0.1},"visualizer_color_responseRange":{"value":35,"min":-50,"max":50},"visualizer_color_responseDegree":{"value":0.8,"min":0.1,"max":3,"fraction":true,"step":0.1},"visualizer_color_response_toHue":{"value":"0.4 0.839 0.8"},"verticalVisualizer_position":{"value":50,"min":0,"max":100,"fraction":true,"step":0.1},"verticalVisualizer_width":{"value":45,"min":25,"max":100},"verticalVisualizer_alignment":{"value":0,"min":-1,"max":1,"fraction":true,"step":0.01},"verticalVisualizer_color":{"value":"0.176470 0.266667 0.611764"},"verticalVisualizer_bars_width":{"value":38,"min":1,"max":100},"verticalVisualizer_bars_height":{"value":45,"min":10,"max":100},"verticalVisualizer_bars_borderRadius":{"value":0,"min":0,"max":100},"verticalVisualizer_blocks_width":{"value":85,"min":1,"max":100},"verticalVisualizer_blocks_height":{"value":32,"min":10,"max":100},"verticalVisualizer_blocks_thickness":{"value":2,"min":1,"max":10},"verticalVisualizer_wave_height":{"value":30,"min":10,"max":100},"verticalVisualizer_wave_showMirrorWave":{"value":true},"verticalVisualizer_wave_fill":{"value":false},"verticalVisualizer_wave_thickness":{"value":1,"min":1,"max":5},"verticalVisualizer_wave_smoothness":{"value":0,"min":0,"max":1,"fraction":true,"step":0.1},"circularVisualizer_x":{"value":50,"min":0,"max":100,"fraction":true,"step":0.1},"circularVisualizer_y":{"value":50,"min":0,"max":100,"fraction":true,"step":0.1},"circularVisualizer_radius":{"value":16,"min":10,"max":35},"circularVisualizer_rotation":{"value":0,"min":0,"max":360},"circularVisualizer_angle":{"value":360,"min":90,"max":360},"circularVisualizer_color":{"value":"0.176470 0.266667 0.611764"},"circularVisualizer_bars_width":{"value":60,"min":1,"max":100},"circularVisualizer_bars_height":{"value":55,"min":10,"max":100},"circularVisualizer_blocks_width":{"value":100,"min":1,"max":100},"circularVisualizer_blocks_height":{"value":50,"min":10,"max":100},"circularVisualizer_blocks_thickness":{"value":2,"min":1,"max":10},"circularVisualizer_wave_height":{"value":30,"min":10,"max":100},"circularVisualizer_wave_showMirrorWave":{"value":false},"circularVisualizer_wave_fill":{"value":false},"circularVisualizer_wave_thickness":{"value":1,"min":1,"max":5},"circularVisualizer_wave_smoothness":{"value":0,"min":0,"max":1,"fraction":true,"step":0.1},"clock":{"value":false},"clock_pivot":{"options":[{"value":"Center"},{"value":"Top"},{"value":"Left"},{"value":"Bottom"},{"value":"Right"},{"value":"TopLeft"},{"value":"BottomLeft"},{"value":"BottomRight"},{"value":"TopRight"}],"value":"Bottom"},"clock_position_x":{"value":50,"min":0,"max":100,"fraction":true,"step":0.1},"clock_position_y":{"value":96,"min":0,"max":100,"fraction":true,"step":0.1},"clock_digital_font":{"options":[{"value":"OpenSans"},{"value":"Heebo"},{"value":"Arapey"},{"value":"LocalFont"}],"value":"OpenSans"},"clock_digital_fontsize":{"value":72,"min":18,"max":192},"clock_digital_text_color":{"value":"1 1 1"},"clock_custom_css":{"value":""},"clock_seconds":{"value":false},"clock_digital_24h":{"value":true},"clock_digital_locale":{"value":""},"spotify":{"value":false},"spotify_backend_url":{"value":""},"spotify_token":{"value":""},"spotify_pivot":{"options":[{"value":"Center"},{"value":"Top"},{"value":"Left"},{"value":"Bottom"},{"value":"Right"},{"value":"TopLeft"},{"value":"BottomLeft"},{"value":"BottomRight"},{"value":"TopRight"}],"value":"BottomRight"},"spotify_position_x":{"value":100,"min":0,"max":100,"fraction":true,"step":0.1},"spotify_position_y":{"value":96,"min":0,"max":100,"fraction":true,"step":0.1},"spotify_width":{"value":255,"min":200,"max":500},"spotify_font_size":{"value":18,"min":14,"max":60},"spotify_text_color":{"value":"1 1 1"},"spotify_background_type":{"options":[{"value":"Color"},{"value":"Css"}],"value":"Color"},"spotify_background_color":{"value":"0.023529 0.274510 0.196078"},"spotify_background_color_alpha":{"value":60,"min":0,"max":100},"spotify_background_css":{"value":"background: linear-gradient(180deg, #011911 0%,#053f2d 22%,#074f38 50%,#074f38 50%,#053f2d 78%,#011911 100%);"},"spotify_art":{"value":true},"spotify_art_type":{"options":[{"value":"AlbumArt"},{"value":"SpotifyIcon"}],"value":"SpotifyIcon"},"spotify_art_fetch_local":{"value":false},"spotify_art_fetch_local_cache_age":{"value":5,"min":1,"max":28},"spotify_scroll":{"value":true},"spotify_scroll_type":{"options":[{"value":"Automatic"},{"value":"OnMouseOver"}],"value":"OnMouseOver"},"spotify_scroll_speed":{"value":30,"min":15,"max":75},"spotify_scroll_auto_delay":{"value":3,"min":2,"max":10,"fraction":true,"step":0.1},"spotify_progressbar":{"value":false},"spotify_progressbar_position":{"options":[{"value":"Top"},{"value":"Bottom"}],"value":"Bottom"},"spotify_progressbar_color":{"value":"0.639215 0.749019 0.698039"},"icue":{"value":true},"icue_boost":{"value":6,"min":0.1,"max":10,"fraction":true,"step":0.1},"icue_spectrum_start":{"value":0,"min":0,"max":100},"icue_spectrum_width":{"value":100,"min":0,"max":100}}')},115:function(e,t,r){"use strict";r.d(t,"a",(function(){return Ar}));var n=r(48),o=r.n(n),a=r(195),i=r.n(a),l=r(19),s=r.n(l),c=r(9),u=r.n(c),d=r(28),h=r.n(d),p=r(0),v=r.n(p),g=r(8);let f;f=Symbol.iterator;class b{get raw(){return this._raw.slice()}constructor(e,t){if(this._raw=void 0,this.length=void 0,this.channels=void 0,this.length=e.length/t,!Number.isFinite(this.length)||this.length*t!==e.length)throw new Error("Wrong number of samples.");this._raw=e.slice(),this.channels=t}getSample(e){const t=[];for(let r=0;r<this.channels;++r)t.push(this._raw[r*this.length+e]);return t}getChannel(e){return this._raw.slice(e*this.length,e*this.length+this.length)}clear(){this._raw.fill(0)}max(){var e;return null!==(e=s()(this._raw))&&void 0!==e?e:0}forEach(e){for(let t=0;t<this.length;++t)e(this.getSample(t),t,this)}slice(e,t){const r=[];for(let n=0;n<this.channels;++n)r.push(...this.getChannel(n).slice(e,t));return new b(r,this.channels)}[f](){let e=0;return{next:()=>e<this.length?{value:this.getSample(e++),done:!1}:{value:null,done:!0}}}}class m{get raw(){return this._raw.slice()}get size(){return this._size}get length(){return this._raw.length}constructor(e){if(this._raw=[],this._size=void 0,!Number.isFinite(e))throw new Error("Size must be finite");if(e<=0)throw new Error("Size must be a positive number");this._size=e}get(e){if(e>=this.size)throw new Error("Index is out of range.");return this._raw[e]}push(e){for(;this._raw.length>=this._size;)this.shift();this._raw.push(e)}resize(e){if(!(e===this._size||e<=0)&&Number.isFinite(e)){if(e<this._size)for(let t=this._size-e;t>0;--t)this.shift();this._size=e}}peak(e=1){return this._raw.slice(this._size-e-1)}shift(){this._raw.shift()}}var y=r(77);const w=[1.1760367470305,.85207379418243,.68842437227852,.63767902570829,.5452348949654,.50723325864167,.4677726234682,.44204182748767,.41956517802157,.41517375040002,.41312118577934,.40618363960446,.39913707474975,.38207008614508,.38329789106488,.37472136606245,.36586428412968,.37603017335105,.39762590761573,.39391828858591,.37930603769622,.39433365764563,.38511504613859,.39082579241834,.3811852720504,.40231453727161,.40244151133175,.39965366884521,.39761103827545,.51136400422212,.66151212038954,.66312205226679,.7416276690995,.74614971301133,.84797007577483,.8573583910469,.96382997811663,.99819377577185,1.0628692615814,1.1059083969751,1.1819808497335,1.257092297208,1.3226521464753,1.3735992532905,1.4953223705889,1.5310064942373,1.6193923584808,1.7094805527135,1.7706604552218,1.8491987941428,1.9238418849406,2.0141596921333,2.0786429508827,2.1575522518646,2.2196355526005,2.2660112509705,2.320762171749,2.3574848254513,2.3986127976537,2.4043566176474,2.4280476777842,2.3917477397336,2.4032522546622,2.3614180150678];var O=r(79);var k=Object(p.createContext)(void 0);const _=g.a.getLogger("Renderer","#703431");function S(e=0){let t=e,r=!1;const n=new Map;let o=0;const a=new Set,i=new Set;let l=0;function s(){o=window.requestAnimationFrame(s);const e=performance.now(),c=e-l;(0===t||c>1e3/t)&&(l=e-c%(1e3/t),function(e){r&&(a.forEach(t=>t(e)),n.forEach((t,r,n)=>{n.delete(r),t(e)}),i.size>0&&setTimeout(e=>{i.forEach(t=>t(e))},0,e))}(e))}return _.info("Created!"),{setFps(e){t=e},start(){r||(r=!0,s(),_.info("Started!"))},stop(){r&&(r=!1,window.cancelAnimationFrame(o),_.info("Stopped!"))},queue(e,t){r&&(n.has(e)&&n.delete(e),n.set(e,t))},cancel(e){n.has(e)&&n.delete(e)},renderingEvent:{subscribe(e){a.add(e)},unsubscribe(e){a.delete(e)}},renderedEvent:{subscribe(e){i.add(e)},unsubscribe(e){i.delete(e)}}}}var C=r(17);const j=g.a.getLogger("useWallpaperBackground","darkolivegreen");var x=r(25),R=r(32);const P=g.a.getLogger("iCUE Plugin","black");class E{constructor(e){this.keyboardCanvas=void 0,this.mouseCanvas=void 0,this.nodeCanvas=void 0,this.getOptions=void 0,this.getOptions=e.getOptions,this.keyboardCanvas=document.createElement("canvas"),this.keyboardCanvas.width=100,this.keyboardCanvas.height=20,this.mouseCanvas=document.createElement("canvas"),this.mouseCanvas.width=20,this.mouseCanvas.height=20,this.nodeCanvas=document.createElement("canvas"),this.nodeCanvas.width=50,this.nodeCanvas.height=5,void 0===window.cue?P.warn("window.cue is undefined"):window.cue.getProtocolDetails(e=>{P.info(`Loaded! SDK: ${e.sdkVersion}, server: ${e.serverVersion}`)})}getEncodedImageData(e){const t=e.getImageData(0,0,e.canvas.width,e.canvas.height),r=[];for(let e=0;e<t.data.length;e+=4){const n=e/4*3;r[n]=t.data[e],r[n+1]=t.data[e+1],r[n+2]=t.data[e+2]}return String.fromCharCode(...r)}getDevices(){return new Promise(e=>{void 0===window.cue?e([]):window.cue.getDeviceCount(t=>{if(void 0===window.cue)e([]);else{const r=[];for(let e=0;e<t;++e){const t=e;r.push(new Promise(e=>{void 0!==window.cue?window.cue.getDeviceInfo(t,r=>e(r.capsMask.CDC_Lighting?{i:t,info:r}:void 0)):e(void 0)}))}Promise.all(r).then(t=>e(t.filter(e=>void 0!==e)))}})})}processAudioData(e){return Promise.resolve()}async processVisualizerSamplesData(e){if(void 0===window.cue)return;if(void 0===e.samples)return;const t=await this.getDevices();if(0===t.length)return;const r=this.getOptions(),n=R.b.buildAudioResponsiveValueProvider(R.a.ValueNormalized,e.colorResponseValueGain),a=Math.round((e.samples.length-1)*(r.spectrumStart/100)),i=Math.clamp(a+Math.round((e.samples.length-a)*(r.spectrumWidth/100)),0,e.samples.length-1),l=0===a&&i===e.samples.length-1?e.samples:e.samples.slice(a,i+1),c=[],u=t.filter(e=>"CDT_Keyboard"===e.info.type);c.push(new Promise((t,a)=>{if(void 0===window.cue)return void t();const i=this.keyboardCanvas.getContext("2d");if(null!==i){try{if(u.length>0){const t=15,a=l.length/t,c=i.canvas.width/t;let d=0;const h=[];l.forEach((e,t)=>{t>=Math.floor((d+1)*a)&&d++;const r=o()(e),n=h[d];void 0===n?h[d]={value:r,n:1}:(n.value+=r,n.n++)}),i.clearRect(0,0,i.canvas.width,i.canvas.height),e.colorReactionType!==x.b.None&&(i.setFillColorRgb(e.color),i.fillRect(0,0,i.canvas.width,i.canvas.height));const p=h.map(e=>void 0!==e?Math.clamp(e.value/e.n,0,1):0),v=s()(p);p.forEach((t,o)=>{const a=t>=0?t:0,l=n([a,0],o,{samplesBuffer:void 0,peak:v});let s=e.color;void 0!==e.colorReaction&&(s=e.colorReaction(l[0]));const u=Math.clamp(i.canvas.height*a*r.boost,0,i.canvas.height);i.setFillColorRgb(s),i.fillRect(c*o,i.canvas.height-u,c,u)}),window.cue.setLedColorsByImageData(u.map(e=>e.i),this.getEncodedImageData(i),i.canvas.width,i.canvas.height)}}catch(e){a(e)}t()}else t()}));const d=t.filter(e=>"CDT_MouseMat"===e.info.type);c.push(new Promise((t,o)=>{if(void 0===window.cue)return void t();const a=this.mouseCanvas.getContext("2d");if(null!==a){try{if(d.length>0){var i,c;const t=null!==(i=s()(l.getChannel(0)))&&void 0!==i?i:0,o=null!==(c=s()(l.getChannel(1)))&&void 0!==c?c:0,u=Math.max(t,o);a.clearRect(0,0,a.canvas.width,a.canvas.height),e.colorReactionType!==x.b.None&&(a.setFillColorRgb(e.color),a.fillRect(0,0,a.canvas.width,a.canvas.height));const h=n([t,o],0,{samplesBuffer:void 0,peak:u});let p=[e.color,e.color];void 0!==e.colorReaction&&(p=[e.colorReaction(h[0]),e.colorReaction(h[1])]);const v=Math.clamp(a.canvas.height*t*r.boost,0,a.canvas.height);a.setFillColorRgb(p[0]),a.fillRect(0,a.canvas.height-v,a.canvas.width,v);const g=Math.clamp(a.canvas.height*o*r.boost,0,a.canvas.height);a.setFillColorRgb(p[1]),a.fillRect(a.canvas.width/2,a.canvas.height-g,a.canvas.width/2,g),window.cue.setLedColorsByImageData(d.map(e=>e.i),this.getEncodedImageData(a),a.canvas.width,a.canvas.height)}}catch(e){o(e)}t()}else t()}));const h=t.filter(e=>"CDT_LightingNodePro"===e.info.type||"CDT_CommanderPro"===e.info.type);c.push(new Promise((t,o)=>{if(void 0===window.cue)return void t();const a=this.nodeCanvas.getContext("2d");if(null!==a){try{if(d.length>0){var i;const t=null!==(i=s()(l.raw))&&void 0!==i?i:0;a.clearRect(0,0,a.canvas.width,a.canvas.height),e.colorReactionType!==x.b.None&&(a.setFillColorRgb(e.color),a.fillRect(0,0,a.canvas.width,a.canvas.height));const o=n([t,0],0,{samplesBuffer:void 0,peak:1});let c=e.color;void 0!==e.colorReaction&&(c=e.colorReaction(o[0]));const u=Math.clamp(a.canvas.width*t*r.boost,0,a.canvas.width);a.setFillColorRgb(c),a.fillRect(0,0,u,a.canvas.height),window.cue.setLedColorsByImageData(h.map(e=>e.i),this.getEncodedImageData(a),a.canvas.width,a.canvas.height)}}catch(e){o(e)}t()}else t()}));const p=["CDT_Keyboard","CDT_MouseMat","CDT_LightingNodePro","CDT_CommanderPro"],v=t.filter(e=>!p.includes(e.info.type));c.push(new Promise((t,r)=>{if(void 0!==window.cue){try{if(v.length>0){var o;const t=null!==(o=s()(l.raw))&&void 0!==o?o:0,r=n([t,0],0,{samplesBuffer:void 0,peak:1});let a=e.color;void 0!==e.colorReaction&&(a=e.colorReaction(r[0])),window.cue.setAllLedsColorsAsync(v.map(e=>e.i),{r:a[0],g:a[1],b:a[2],ledId:0})}}catch(e){r(e)}t()}else t()})),await Promise.all(c)}}class T{processAudioData(e){return Promise.resolve()}processVisualizerSamplesData(e){return Promise.resolve()}}class M{constructor(){this.plugins=void 0,this.noop=new T,this.plugins=new Map}processAudioData(e){const t=[];return this.plugins.forEach(r=>{t.push(new Promise((t,n)=>{r.processAudioData(e).then(()=>t()).catch(e=>n(e))}))}),t}processVisualizerSamplesData(e){const t=[];return this.plugins.forEach(r=>{t.push(new Promise((t,n)=>{r.processVisualizerSamplesData(e).then(()=>t()).catch(e=>n(e))}))}),t}enable(e,t){let r=this.plugins.get(e);if(void 0===r){switch(e){case"cue":r=new E(t);break;default:return this.noop}this.plugins.set(e,r)}return r}disable(e){return this.plugins.delete(e)}}var z=r(198),I=r.n(z);const B=1,L="black",A="green",N=100,V=5e3,D="#D4C103";function F(e){const t=Object(p.useRef)(null),r=Object(p.useRef)(),n=Object(p.useCallback)(()=>{if(null===t.current)throw new Error("Canvas ref is not bound to any DOM element!");if(void 0===r.current)throw new Error("Canvas context is undefined!")},[]);return Object(p.useEffect)(()=>{var n,o,a;if(null===t.current)throw new Error("Canvas ref is not bound to any DOM element!");t.current.width=e.width*(null!==(n=e.resolution)&&void 0!==n?n:B),t.current.height=e.height*(null!==(o=e.resolution)&&void 0!==o?o:B),r.current=null!==(a=t.current.getContext("2d"))&&void 0!==a?a:void 0},[e.height,e.width,e.resolution]),Object(p.useEffect)(()=>{var o,a,i;n(),t.current.style.backgroundColor=null!==(o=e.backgroundColor)&&void 0!==o?o:L,r.current.strokeStyle=null!==(a=e.lineColor)&&void 0!==a?a:A,r.current.lineWidth=null!==(i=e.resolution)&&void 0!==i?i:B},[n,e.resolution,e.backgroundColor,e.lineColor]),Object(p.useEffect)(()=>{var a,i;n();const l=t.current,c=r.current,u=[],d=null!==(a=e.refreshInterval)&&void 0!==a?a:N,h=l.width/((null!==(i=e.duration)&&void 0!==i?i:V)/d),p=(e,t)=>{const r=t>0?(l.height-4)*(e/t):0;return l.height-r-2};let v=0;const g=()=>{c.clearRect(0,0,l.width,l.height),u.length*h>l.width&&u.shift();const t=e.getValue();if(u.push(t),u.length>1){var r;const t=null!==(r=s()(u))&&void 0!==r?r:1;c.beginPath(),c.moveTo(0,p(u[0],t));for(let e=1;e<u.length;++e)c.lineTo(e*h,p(u[e],t));if(c.stroke(),!1!==e.showAverage&&(e.showAverage||D)){var n;const r=c.strokeStyle,a=p(null!==(n=o()(u))&&void 0!==n?n:0,t);c.strokeStyle=I()(e.showAverage)?e.showAverage:D,c.beginPath(),c.moveTo(0,a),c.lineTo(l.width,a),c.stroke(),c.strokeStyle=r}}v=setTimeout(g,e.refreshInterval)};return g(),()=>{u.length=0,null==c||c.clearRect(0,0,l.width,l.height),clearTimeout(v)}},[n,e]),t}const $=g.a.getLogger("Stats","#323338");function W(){const e=Object(p.useContext)(k),[t,r]=Object(p.useState)(1),[n,o]=Object(p.useState)({fps:0,frameTime:0}),[a,i]=Object(p.useState)(0),[l,s]=Object(p.useState)(0),[c,u]=Object(p.useState)(0),[d,h]=Object(p.useState)(0),g=Object(p.useRef)(0),f=Object(p.useRef)(0);Object(p.useEffect)(()=>{$.info("Initializing component...");let t,n=0,a=0,l=0,c=0,d=0,p=[0,0],v=[0,0];const b=setInterval(()=>{g.current=n,o({fps:g.current,frameTime:n>0?a/n:0}),n=0,a=0,i(c),s(c>0?Math.round(d/c):0),c=0,d=0},1e3),m=setInterval(()=>{u(p[1]>0?p[0]/p[1]:0),h(v[1]>0?v[0]/v[1]:0),p=[0,0],v=[0,0]},150),y=e=>{n++,f.current=l>0?e-l:0,a+=f.current,l=e};null==e||e.renderer.renderedEvent.subscribe(y);const w=e=>{t=e.samples,c++,d+=t.length,p[0]+=e.mean,p[1]++,v[0]+=e.peak,v[1]++};null==e||e.wallpaperEvents.onAudioSamples.subscribe(w);const O=e=>{var r;!1===e.newProps.audioprocessing&&(null===(r=t)||void 0===r||r.clear())};null==e||e.wallpaperEvents.onUserPropertiesChanged.subscribe(O);const k=e=>{void 0!==e.newProps.resolution&&r("half"===e.newProps.resolution?.5:1)};return null==e||e.wallpaperEvents.onGeneralPropertiesChanged.subscribe(k),()=>{clearInterval(b),clearInterval(m),null==e||e.renderer.renderedEvent.unsubscribe(y),null==e||e.wallpaperEvents.onAudioSamples.unsubscribe(w),null==e||e.wallpaperEvents.onUserPropertiesChanged.unsubscribe(O),null==e||e.wallpaperEvents.onGeneralPropertiesChanged.unsubscribe(k)}},[e]);const b=F(Object(p.useMemo)(()=>({width:140,height:30,resolution:t,refreshInterval:500,getValue:()=>g.current,showAverage:!1}),[t])),m=F(Object(p.useMemo)(()=>({width:140,height:30,resolution:t,refreshInterval:50,getValue:()=>f.current}),[t]));return v.a.createElement("div",{id:"stats",className:"overlay p-1",style:{left:0,bottom:30*t,fontSize:14*t}},v.a.createElement("table",null,v.a.createElement("tbody",null,v.a.createElement("tr",null,v.a.createElement("th",null,"Frame rate"),v.a.createElement("td",null,v.a.createElement("div",null,n.fps+"fps")),v.a.createElement("td",{className:"lh-0"},v.a.createElement("canvas",{ref:b,width:0,height:0}))),v.a.createElement("tr",null,v.a.createElement("th",null,"Frame time"),v.a.createElement("td",null,v.a.createElement("div",null,(n.frameTime.toFixed(2)+"ms").padEnd(9," "))),v.a.createElement("td",{className:"lh-0"},v.a.createElement("canvas",{ref:m,width:0,height:0}))),v.a.createElement("tr",null,v.a.createElement("th",null,"Audio Data"),v.a.createElement("td",{colSpan:2},`${a}⨯${2*l} Hz`)),v.a.createElement("tr",null,v.a.createElement("th",null,"Mean"),v.a.createElement("td",{colSpan:2},""+c.toFixed(6))),v.a.createElement("tr",null,v.a.createElement("th",null,"Peak"),v.a.createElement("td",{colSpan:2},""+d.toFixed(6))))))}var H=r(14),G=r.n(H),U=r(37),q=r.n(U),K=r(33);function J(e,t,r){const n=Object(p.useContext)(k);Object(p.useEffect)(()=>{const r=r=>{const n=e(r.newProps);void 0!==n&&t(n)};return null==n||n.wallpaperEvents.onUserPropertiesChanged.subscribe(r),()=>{null==n||n.wallpaperEvents.onUserPropertiesChanged.unsubscribe(r)}},[n,...r])}var X=r(5),Y=r.n(X),Z=r(38);function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){te(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const re={get TTF(){return"application/x-font-truetype"},get OTF(){return"application/x-font-opentype"},get EOT(){return"application/vnd.ms-fontobject"},get WOFF(){return"application/font-woff"},get WOFF2(){return"application/font-woff2"}};function ne(e){return("0"+e.toString(16)).slice(-2).toUpperCase()}function oe(e){null===e?window.localStorage.removeItem("aleab.acav.clock.font"):window.localStorage.setItem("aleab.acav.clock.font",e)}function ae(e){const t=Object(p.useContext)(k),r=Object(p.useRef)(t.wallpaperProperties.clock.digital),[n,o]=Object(p.useState)(r.current.is24h),[a,i]=Object(p.useState)(r.current.locale),[l,s]=Object(p.useReducer)((e,t)=>q()(e,t)?e:G()({},e,t),{fontFamily:r.current.font,fontSize:r.current.fontSize,color:"#"+Y.a.rgb.hex(r.current.textColor)}),[c,u]=Object(p.useState)(new Date),[d,h]=Object(p.useState)(!1),[g,f]=Object(p.useState)(null),[b,m]=Object(p.useState)(!1);J(e=>{var t;return null===(t=e.clock)||void 0===t?void 0:t.digital},e=>{const t={};void 0!==e.font&&(t.fontFamily=e.font===Z.a.LocalFont?"inherit":e.font,h(e.font===Z.a.LocalFont)),void 0!==e.fontSize&&(t.fontSize=e.fontSize),void 0!==e.textColor&&(t.color="#"+Y.a.rgb.hex(e.textColor)),s(t),void 0!==e.locale&&i(e.locale),void 0!==e.is24h&&o(e.is24h)},[]),Object(p.useEffect)(()=>{const e=setInterval(()=>u(new Date),1e3);return()=>clearInterval(e)},[]);const y=Object(p.useMemo)(()=>{const t={hour:"2-digit",minute:"2-digit",second:e.showSeconds?"2-digit":void 0};a||(t.hour12=!n);try{return c.toLocaleTimeString(a||[],t).toUpperCase()}catch{return c.toLocaleTimeString([],t).toUpperCase()}},[n,a,c,e.showSeconds]);Object(p.useEffect)(()=>{r.current.font===Z.a.LocalFont?async function(){const e=localStorage.getItem("aleab.acav.clock.font");return null!==e&&e.startsWith("data:")?fetch(e).then(e=>e.blob()):null}().then(e=>{const t=null!==e?URL.createObjectURL(e):null;f(t),null===t?(h(!0),s({fontFamily:"inherit"})):(h(!1),s({fontFamily:Z.a.LocalFont})),m(!0)}):m(!0)},[]);const w=Object(p.useCallback)(e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(void 0!==r){const e=new FileReader;e.onload=e=>{var t;const n=null===(t=e.target)||void 0===t?void 0:t.result;if(null!=n){const e=function(e){let t="",r=new Uint8Array(e).subarray(0,4);r.forEach(e=>{t+=ne(e)});let n=null;switch(t){case"00000000":t="",r=new Uint8Array(e).subarray(0,34),r.forEach(e=>{t+=ne(e)}),t.endsWith("4C50")&&(n=re.EOT);break;case"00010000":n=re.TTF;break;case"4F54544F":n=re.OTF;break;case"774F4646":n=re.WOFF;break;case"774F4632":n=re.WOFF2}return n}(n)||r.type;if(Object.getOwnPropertyNames(re).some(t=>re[t]===e)){const t=window.btoa(new Uint8Array(n).reduce((e,t)=>e+String.fromCharCode(t),"")),r=`data:${e};base64,${t}`;oe(`data:${e};base64,${t}`),fetch(r).then(e=>e.blob()).then(e=>{f(URL.createObjectURL(e)),h(!1),s({fontFamily:Z.a.LocalFont})})}else h(!1),s({fontFamily:"inherit"})}else h(!1),s({fontFamily:"inherit"})},e.readAsArrayBuffer(r)}else oe(null),f(null),h(!1),s({fontFamily:"inherit"})},[]);return b?v.a.createElement(v.a.Fragment,null,d?v.a.createElement("input",{id:"browseFont",type:"file",style:{color:l.color},accept:".ttf, .otf, .eot, .woff, .woff2",onChange:w}):null,null!==g?v.a.createElement("style",{dangerouslySetInnerHTML:{__html:`@font-face { font-family: "LocalFont"; src: url(${g}); }`}}):null,v.a.createElement("div",{className:"digital",style:ee({},l,{},e.customCss)},y)):null}var ie=r(15);function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){ce(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(){const e=Object(p.useContext)(k),t=Object(p.useRef)(e.wallpaperProperties.clock),[r,n]=Object(p.useState)(t.current.showSeconds),[o,a]=Object(p.useReducer)((e,t)=>q()(e,t)?e:G()({},e,t),{left:Math.round(window.innerWidth*(t.current.left/100)),top:Math.round(window.innerHeight*(t.current.top/100)),transform:Object(K.b)(t.current.pivot).transform}),[i,l]=Object(p.useState)(t.current.customCss),s=Object(p.useMemo)(()=>Object(ie.c)(i),[i]);return J(e=>e.clock,e=>{const t={};void 0!==e.left&&(t.left=Math.round(window.innerWidth*(e.left/100))),void 0!==e.top&&(t.top=Math.round(window.innerHeight*(e.top/100))),void 0!==e.pivot&&(t.transform=Object(K.b)(e.pivot).transform),a(t),void 0!==e.customCss&&l(e.customCss),void 0!==e.showSeconds&&n(e.showSeconds)},[]),v.a.createElement("div",{id:"clock",style:se({},o,{transform:"perspective(1px) translateZ(0) "+o.transform})},v.a.createElement(ae,{showSeconds:r,customCss:s}))}var de=r(209),he=r(199),pe=r.n(he),ve=r(200),ge=r.n(ve),fe=r(201),be=r.n(fe),me=r(202),ye=r.n(me),we=r(203),Oe=r.n(we),ke=r(204),_e=r.n(ke),Se=r(205),Ce=r.n(Se);function je(){return(je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function xe(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Re(e){return function(t){var r;const{className:n}=t,o=xe(t,["className"]);let a=n;return a&&(a=a.split(" ").filter(e=>"svg-inline--fa"!==e&&"fa-w-16"!==e).join(" ")),v.a.createElement(e,je({role:"img","aria-hidden":"true",focusable:!1,fill:"currentColor",className:"svg-inline--fa fa-w-16 "+(null!==(r=a)&&void 0!==r?r:"")},o))}}const Pe=Re(pe.a),Ee=Re(ge.a),Te=Re(be.a),Me=Re(ye.a),ze=Re(Oe.a),Ie=Re(_e.a),Be=Re(Ce.a);function Le(e,t){fetch("https://dns.google",{method:"HEAD"}).then(e).catch(t)}var Ae=r(78),Ne=r(59),Ve=r(21),De=r.n(Ve),Fe=r(91),$e=r(13);function We(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function He(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Ge=g.a.getLogger("SpofitySM","#1DB954","background-color: #191414;");var Ue,qe,Ke;function Je(e){return De()(e)&&e.access_token&&e.refresh_token&&e.expires_at}async function Xe(e,t,r=3){var n;try{const r=await fetch(e.backendUrl+"/refresh",{method:"POST",body:new URLSearchParams({refresh_token:t.refresh_token})});switch(r.status){case 200:return r.json().then(e=>e.access_token&&e.expires_at?(t.access_token=e.access_token,t.expires_at=Number(e.expires_at),window.localStorage.setItem("aleab.acav.spotify",JSON.stringify(t)),Object($e.raise)(qe.SpotifyTokenRefreshed)):(Ge.error("The backend returned an invalid refreshed token object (!?):",e),Object($e.raise)(qe.ErrorWhileRefreshingSpotifyToken)));case 400:return r.text().then(e=>(""===e||Ge.error("The backend returned 400:",JSON.parse(e)),Object($e.raise)(qe.ErrorWhileRefreshingSpotifyToken)));case 401:return Object($e.raise)(qe.SpotifyTokenRevoked);case 404:return Object($e.raise)({type:qe.RefreshTokenAfterSeconds,seconds:5,status:404,error:"Server is down!"});case 429:return Object($e.raise)({type:qe.RefreshTokenAfterSeconds,seconds:Number(null!==(n=r.headers.get("Retry-After"))&&void 0!==n?n:4)+1,status:429});case 500:{const e={type:qe.RefreshTokenAfterSeconds,seconds:5,status:500};return r.json().then(t=>Object($e.raise)(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?We(Object(r),!0).forEach((function(t){He(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):We(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e,{error:t.message}))).catch(()=>Object($e.raise)(e))}default:return r.text().then(e=>(Ge.error(`The backend returned ${r.status}:`,{body:e}),Object($e.raise)(qe.ErrorWhileRefreshingSpotifyToken)))}}catch(n){return r<=0?(Ge.error(n),Object($e.raise)(qe.NoInternetConnection)):new Promise(e=>setTimeout(e,1e3)).then(()=>Xe(e,t,r-1))}}!function(e){e.S0Unknown="S0Unknown",e.S1WaitingUserToken="S1WaitingUserToken",e.S2HasOldToken="S2HasOldToken",e.S3HasNewToken="S3HasNewToken",e.S4CheckingAT="S4CheckingAT",e.S5HasATIdle="S5HasATIdle",e.S6CantGetTokenErrorIdle="S6CantGetTokenErrorIdle",e.S7RetryWaiting="S7RetryWaiting",e.SNNoInternetConnection="SNNoInternetConnection"}(Ue||(Ue={})),function(e){e.Init="Init",e.NoInternetConnection="NoInternetConnection",e.InternetConnectionRestored="InternetConnectionRestored",e.UserEnteredToken="UserEnteredToken",e.BackendTokenBadRequestOrForbidden="BackendTokenBadRequestOrForbidden",e.GotSpotifyToken="GotSpotifyToken",e.CouldntGetBackendTokenFatalError="CouldntGetBackendTokenFatalError",e.ErrorWhileRefreshingSpotifyToken="ErrorWhileRefreshingSpotifyToken",e.SpotifyTokenRevoked="SpotifyTokenRevoked",e.SpotifyTokenRefreshed="SpotifyTokenRefreshed",e.Idle="Idle",e.RefreshTokenAfterSeconds="RefreshTokenAfterSeconds",e.SpotifyTokenExpired="SpotifyTokenExpired",e.WaitEnd="WaitEnd"}(qe||(qe={})),function(e){e.LogInitializationContext="LogInitializationContext",e.RemoveSpotifyToken="RemoveSpotifyToken"}(Ke||(Ke={}));var Ye=Object(Fe.a)({id:"spotify",initial:Ue.S0Unknown,entry(e){var t;Ge.info("Created!");const r=JSON.parse(null!==(t=window.localStorage.getItem("aleab.acav.spotify"))&&void 0!==t?t:"null");Je(r)?e.spotifyToken=r:(e.spotifyToken=void 0,window.localStorage.removeItem("aleab.acav.spotify"))},states:{[Ue.S0Unknown]:{entry:()=>Ge.debug("~> (0)"),invoke:{src:async(e,t)=>t.type===qe.InternetConnectionRestored,onDone:[{cond:(e,t)=>!t.data},{target:Ue.S4CheckingAT,cond:"hasLsToken"},{target:Ue.S2HasOldToken,cond:"hasToken"},{target:Ue.S1WaitingUserToken}]},on:{[qe.Init]:[{actions:Ke.LogInitializationContext,target:Ue.S4CheckingAT,cond:"hasLsToken"},{actions:Ke.LogInitializationContext,target:Ue.S2HasOldToken,cond:"hasToken"},{actions:Ke.LogInitializationContext,target:Ue.S1WaitingUserToken}]}},[Ue.S1WaitingUserToken]:{entry:()=>{Ge.debug("~> (1)"),Ge.debug("Waiting for user to enter a token.")},on:{[qe.UserEnteredToken]:Ue.S3HasNewToken}},[Ue.S2HasOldToken]:{entry:()=>Ge.debug("~> (2)"),on:{"":Ue.S1WaitingUserToken}},[Ue.S3HasNewToken]:{invoke:{id:"3_fetchToken",src:async e=>(Ge.debug("~> (3)"),async function e(t,r=3){try{const e=await fetch(t.backendUrl+"/token",{method:"POST",body:new URLSearchParams({token:t.token.current})});switch(e.status){case 200:return await e.json().then(e=>Je(e)?(Ge.debug("Received a valid token:",e),window.localStorage.setItem("aleab.acav.spotify",JSON.stringify(e)),Object($e.raise)(qe.GotSpotifyToken)):(Ge.error("The backend returned an invalid token (!?):",e),Object($e.raise)({type:qe.CouldntGetBackendTokenFatalError,error:"Token server returned an invalid token!"})));case 400:case 403:return Object($e.raise)(qe.BackendTokenBadRequestOrForbidden);case 404:return Object($e.raise)({type:qe.CouldntGetBackendTokenFatalError,error:"Server is down! Retry later."});case 500:return Object($e.raise)({type:qe.CouldntGetBackendTokenFatalError,error:"Unexpected internal server error"});default:return e.text().then(t=>(Ge.error(`The backend returned ${e.status}:`,{body:t}),Object($e.raise)({type:qe.CouldntGetBackendTokenFatalError,error:`Unexpected response from token server (${e.status})`})))}}catch(n){return r<=0?(Ge.error(n),Object($e.raise)(qe.NoInternetConnection)):new Promise(e=>setTimeout(e,1e3)).then(()=>e(t,r-1))}}(e)),onDone:[{target:Ue.S1WaitingUserToken,cond:(e,t)=>{var r;return(null===(r=t.data)||void 0===r?void 0:r.event)===qe.BackendTokenBadRequestOrForbidden}},{target:Ue.S4CheckingAT,cond:(e,t)=>{var r;return(null===(r=t.data)||void 0===r?void 0:r.event)===qe.GotSpotifyToken}},{target:Ue.S6CantGetTokenErrorIdle,cond:(e,t)=>{var r;return(null===(r=t.data)||void 0===r?void 0:r.event)===qe.CouldntGetBackendTokenFatalError}},{target:Ue.SNNoInternetConnection,cond:(e,t)=>{var r;return(null===(r=t.data)||void 0===r?void 0:r.event)===qe.NoInternetConnection}},{actions:(e,t)=>Ge.warn("(3) Unexpected event:",h()(t))}]},on:{[qe.NoInternetConnection]:Ue.SNNoInternetConnection}},[Ue.S4CheckingAT]:{invoke:{id:"4",src:async e=>{Ge.debug("~> (4)");const t=JSON.parse(window.localStorage.getItem("aleab.acav.spotify"));return t?t.expires_at-1e4>Date.now()?(e.spotifyToken=t,Object($e.raise)(qe.Idle)):Xe(e,t):Object($e.raise)(qe.ErrorWhileRefreshingSpotifyToken)},onDone:[{target:Ue.S2HasOldToken,cond:(e,t)=>{var r,n;return(null===(r=t.data)||void 0===r?void 0:r.event)===qe.ErrorWhileRefreshingSpotifyToken||(null===(n=t.data)||void 0===n?void 0:n.event)===qe.SpotifyTokenRevoked},actions:Ke.RemoveSpotifyToken},{target:Ue.S4CheckingAT,cond:(e,t)=>{var r;return(null===(r=t.data)||void 0===r?void 0:r.event)===qe.SpotifyTokenRefreshed}},{target:Ue.S5HasATIdle,cond:(e,t)=>{var r;return(null===(r=t.data)||void 0===r?void 0:r.event)===qe.Idle}},{target:Ue.S7RetryWaiting,cond:(e,t)=>{var r,n;return(null===(r=t.data)||void 0===r||null===(n=r.event)||void 0===n?void 0:n.type)===qe.RefreshTokenAfterSeconds}},{target:Ue.SNNoInternetConnection,cond:(e,t)=>{var r;return(null===(r=t.data)||void 0===r?void 0:r.event)===qe.NoInternetConnection}},{actions:(e,t)=>Ge.warn("(4) Unexpected event:",h()(t))}]},on:{[qe.NoInternetConnection]:Ue.SNNoInternetConnection}},[Ue.S5HasATIdle]:{entry:()=>Ge.debug("~> (5)"),on:{[qe.SpotifyTokenExpired]:Ue.S4CheckingAT,[qe.NoInternetConnection]:Ue.SNNoInternetConnection}},[Ue.S6CantGetTokenErrorIdle]:{entry:()=>{Ge.debug("~> (6)"),Ge.debug("Waiting for user to enter a token.")},on:{[qe.UserEnteredToken]:Ue.S3HasNewToken}},[Ue.S7RetryWaiting]:{entry:()=>Ge.debug("~> (7)"),after:[{target:Ue.S4CheckingAT,delay:(e,t)=>{const r=t.data.event;return r.seconds>0?1e3*r.seconds:5e3}}]},[Ue.SNNoInternetConnection]:{entry:()=>Ge.debug("~> (N)"),on:{[qe.InternetConnectionRestored]:Ue.S0Unknown}}}},{actions:{[Ke.LogInitializationContext]:e=>{Ge.debug("Initialization context:",{token:e.token.current,spotifyToken:e.spotifyToken}),Ge.info("Initialized!")},[Ke.RemoveSpotifyToken]:e=>{window.localStorage.removeItem("aleab.acav.spotify"),delete e.spotifyToken}},guards:{hasToken:e=>!u()(e.token.current),hasLsToken:e=>Je(e.spotifyToken)}});var Ze=r(107),Qe=r.n(Ze),et=r(108),tt=r(206);class rt{constructor(){this.baseUrl="https://coverartarchive.org"}_fetch(e,t,r=!0){return fetch(`${this.baseUrl}/${t}`,{method:e,headers:{Accept:"application/json"},redirect:r?"follow":"manual"})}get(e,t=!0){return this._fetch("GET",e,t)}async getAll(e,t){if(!e||!t)return null;try{const r=await this.get(`${e}/${t}`);switch(r.status){case 200:return await r.json();case 503:return;default:return null}}catch(e){return null}}async getFrontExists(e,t,r){if(!e||!t)return!1;let n=`${e}/${t}/front`;if(void 0!==r){if(250!==r&&500!==r&&1200!==r)return!1;n+="-"+r}try{const e=await this.get(n,!1);switch(e.status){case 0:return"opaqueredirect"===e.type;case 307:return null!==e.headers.get("Location");case 503:return;default:return!1}}catch(e){return!1}}getFrontUrl(e,t,r){if(e&&t&&(250===r||500===r||1200===r))return`${this.baseUrl}/${e}/${t}/front-${r}`}}function nt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ot(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(r),!0).forEach((function(t){at(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function at(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const it=g.a.getLogger("MusicBrainzClient","#BA478F");function lt(e){return null==e||u()(e)}function st(e){return null==e?void 0:e.replace(/[+\-&|!(){}[\]^"~*?:\\]/g,"\\$&")}function ct(e,t=.75){let r;const n=e.split(" ").filter(e=>e.length>0);return n.length>2&&(r=`"${e}"~${Math.round(n.length*t)}`),[r,n]}class ut{constructor(e=!1){this.api=void 0,this.recordingsFuseOptions=void 0,this.releaseGroupsFuseOptions=void 0,this.coverArtArchiveApi=void 0,this.verbose=void 0,this.api=new tt.MusicBrainzApi({setUserAgent:!1,appName:"aCAV-WE",appVersion:"1.3.0",appContactInfo:"https://github.com/aleab/acav-we"});const t={caseSensitive:!1,includeScore:!0,shouldSort:!0,location:0,threshold:.4,distance:100};this.recordingsFuseOptions=ot({},t,{keys:["artist-credit.artist.name","artist-credit.artist.aliases.name","artist-credit.artist.sort-name","artist-credit.artist.aliases.sort-name"]}),this.releaseGroupsFuseOptions=ot({},t,{keys:["artist-credit.artist.name","artist-credit.artist.aliases.name","artist-credit.artist.sort-name","artist-credit.artist.aliases.sort-name"]}),this.coverArtArchiveApi=new rt,this.verbose=e,this.logVerbose=e?it.debug:()=>{},it.info("Initialized!")}logVerbose(...e){}async findCoverArtByReleaseGroup(e){var t,r;if(lt(e.album))return;const n=st(e.album),o=null===(t=e.artists)||void 0===t?void 0:t.map(e=>st(e)),a=[],i=[],l=[];if(!lt(n)){a.push([`releasegroup:"${n}"`,100]),i.push([`release:"${n}"`,90]);const[e,t]=ct(n,.75);if(void 0!==e&&(a.push(["releasegroup:"+e,70]),i.push(["release:"+e,60])),t.length>5){const[e]=ct(t.slice(0,Math.ceil(t.length/2)).join(" "),.75);void 0!==e&&(a.push(["releasegroup:"+e,65]),i.push(["release:"+e,55]));const[r]=ct(t.slice(Math.ceil(t.length/2)).join(" "),.75);void 0!==r&&(a.push(["releasegroup:"+r,64]),i.push(["release:"+r,54]))}}void 0===o||lt(o[0])||l.push([`artist:"${o[0]}"`,80]);const s=(e,t)=>{if(0===e.length)return;const r=e.map(([e,r])=>`${e}^${t(r)}`).join(" OR ");return e.length>1?`(${r})`:r};let c=[s(a,e=>2*e),s(i,e=>2*e)].filter(e=>void 0!==e).join(" OR ");c=[lt(c)?void 0:`(${c})`,s(l,e=>e)].filter(e=>void 0!==e).join(" AND ");const u=[s(a,e=>e),s(i,e=>e)].filter(e=>void 0!==e).join(" OR "),d=[];d.push(`(${c})`,`(${u})`);const h=d.join(" OR ");if(0===d.length)return null;it.debug("findCoverArt",e),this.logVerbose("--\x3e queryTerms",d);let p,v=null;try{p=await this.api.searchReleaseGroup(h,0,20),this.logVerbose("-- mbSearchResult",p)}catch(e){return it.error("ERROR",e),null}if(p["release-groups"].length>0)if(void 0!==o&&o.length>0){const e=new et.a(p["release-groups"],this.releaseGroupsFuseOptions).search(o[0]);if(this.logVerbose("--\x3e fuseResult",e),e.length>0){const t=e.map(e=>{var t;return ot({},e,{_score:e.item.score*(1-(null!==(t=e.score)&&void 0!==t?t:1))})}),r=Qe()(t,[e=>-e._score,e=>e.refIndex]);r[0]._score>=75&&(v=r[0].item)}}else p["release-groups"][0].score>=75&&(v=p["release-groups"][0]);const g=null===(r=v)||void 0===r?void 0:r.releases;if(it.debug("--\x3e mbReleases",g),void 0!==g&&g.length>0){const e=[],t=[];return g.forEach(e=>{t.push(new Promise(t=>{this.coverArtArchiveApi.getFrontExists("release",e.id).then(r=>{t({release:e.id,exists:void 0!==r&&r})}).catch(()=>t({release:e.id,exists:!1}))}))}),(await Promise.all(t)).forEach(t=>{if(t.exists){const r={release:t.release,cover:[]};[250,500,1200].forEach(e=>{const n=this.coverArtArchiveApi.getFrontUrl("release",t.release,e);null!=n&&r.cover.push({size:e,url:n})}),r.cover.length>0&&e.push(r)}}),it.debug("--\x3e releasesCoverArts",e),e.length>0?e:null}return null}async findCoverArtByRecording(e){var t,r;if(lt(e.title))return;const n=st(e.title),o=st(e.album),a=null===(t=e.artists)||void 0===t?void 0:t.map(e=>st(e)),i=[];if(!lt(n)){const e=[`recording:/${l=n,null==l?void 0:l.replace(/[-[\]{}()*+?.,\\^$|#\\s]/g,"\\$&")}/^10`,`recording:"${n}"^9`].join(" OR ");i.push(`(${e})`)}var l;if(!lt(o)){const e=[],t=`"${o}"`,[r,n]=ct(o,.75);if(e.push({term:t,boost:11}),void 0!==r&&e.push({term:r,boost:10}),n.length>5){const[t]=ct(n.slice(0,Math.ceil(n.length/2)).join(" "),.75),[r]=ct(n.slice(Math.ceil(n.length/2)).join(" "),.75);void 0!==t&&e.push({term:t,boost:9}),void 0!==r&&e.push({term:r,boost:9})}const a=e.map(e=>e.boost>1?`release:${e.term}^${e.boost}`:"release:"+e.term).join(" OR ");i.push(`(${a})`)}if(0===i.length)return null;it.debug("findCoverArt",e),this.logVerbose("--\x3e queryTerms",i);let s,c=null;try{s=await this.api.searchRecording(i.join(" AND "),0,20),this.logVerbose("--\x3e mbSearchResult",s)}catch(e){return it.error("ERROR",e),null}if(s.recordings.length>0)if(void 0!==a&&a.length>0){const e=new et.a(s.recordings,this.recordingsFuseOptions).search(a[0]);if(this.logVerbose("--\x3e fuseResult",e),e.length>0){const t=e.map(e=>{var t;return ot({},e,{_score:e.item.score*(1-(null!==(t=e.score)&&void 0!==t?t:1))})}),r=Qe()(t,[e=>-e._score,e=>e.refIndex]);r[0]._score>=75&&(c=r[0].item)}}else s.recordings[0].score>=75&&(c=s.recordings[0]);const u=null===(r=c)||void 0===r?void 0:r.releases;if(it.debug("--\x3e mbReleases",u),void 0!==u&&u.length>0){const e=[],t=[];return u.forEach(e=>{t.push(new Promise(t=>{this.coverArtArchiveApi.getFrontExists("release",e.id).then(r=>{t({release:e.id,exists:void 0!==r&&r})}).catch(()=>t({release:e.id,exists:!1}))}))}),(await Promise.all(t)).forEach(t=>{if(t.exists){const r={release:t.release,cover:[]};[250,500,1200].forEach(e=>{const n=this.coverArtArchiveApi.getFrontUrl("release",t.release,e);null!=n&&r.cover.push({size:e,url:n})}),r.cover.length>0&&e.push(r)}}),it.debug("--\x3e releasesCoverArts",e),e.length>0?e:null}return null}}var dt=r(81);function ht(...e){const t=e.join(".");let r=0;for(let e=0;e<t.length;e++){r=(r<<5)-r+t.charCodeAt(e),r&=r}return r}function pt(e){var t;return ht(null!==(t=e.album)&&void 0!==t?t:"",void 0!==e.artists&&e.artists.length>0?e.artists[0]:"")}const vt=g.a.getLogger("MusicbrainzClientCache","#EC74C0","background-color: #1E1A23");class gt{get ttl(){return this._ttl}set ttl(e){this._ttl=e>3e4?e:3e4}constructor(e,t){var r;if(this.mbClient=void 0,this.cacheName=void 0,this._ttl=864e5,this.db=void 0,this.cacheMaintenanceInterval=void 0,this.cacheMaintenanceTimeoutId=0,this._initLock=!1,null===t.cacheName||void 0===t.cacheName||!/[a-z]/i.test(t.cacheName))throw new Error("Invalid cache name!");this.mbClient=e,this.cacheName=t.cacheName,this.ttl=null!==(r=t.ttlMs)&&void 0!==r?r:864e5,this.cacheMaintenanceInterval=void 0!==t.cacheMaintenanceInterval?t.cacheMaintenanceInterval>3e5?t.cacheMaintenanceInterval:3e5:18e5}async init(){this._initLock||void 0===this.db&&(this._initLock=!0,this.db=await Object(dt.a)(this.cacheName,1,{upgrade(e){e.createObjectStore("musicbrainz-covers").createIndex("by-updatedDate","timestamp"),e.createObjectStore("musicbrainz-cover-urls").createIndex("by-updatedDate","timestamp")}}),this.db&&(vt.info("Initialized!"),this.cacheMaintenanceTimeoutId=setTimeout(this.doCacheMaintenanceLoop.bind(this),5e3)))}async findCoverArtByReleaseGroup(e){var t;if(e.album&&(null===(t=e.artists)||void 0===t?void 0:t[0])&&(void 0===this.db&&await this.init(),this.db)){const t=pt(e),r=await this.db.get("musicbrainz-covers",t);let n;return void 0===r||this.hasExpired(r.timestamp)?(n=await this.mbClient.findCoverArtByReleaseGroup(e),await this.db.put("musicbrainz-covers",{get updatedAt(){return new Date(this.timestamp).toISOString()},timestamp:Date.now(),covers:n,album:{name:e.album,artists:e.artists}},t)):(n=r.covers,vt.debug("Pulled cover art from cache:",{key:t})),n}return this.mbClient.findCoverArtByReleaseGroup(e)}async cacheRealUrl(e,t){if(e&&t&&(void 0===this.db&&await this.init(),this.db)){const r=await this.db.get("musicbrainz-cover-urls",e);void 0!==r&&t===r.url||await this.db.put("musicbrainz-cover-urls",{get updatedAt(){return new Date(this.timestamp).toISOString()},timestamp:Date.now(),url:t},e)}}async getCachedRealUrl(e){if(e&&(void 0===this.db&&await this.init(),this.db)){const t=await this.db.get("musicbrainz-cover-urls",e);if(void 0!==t&&!this.hasExpired(t.timestamp))return vt.debug("Pulled cover art url from cache:",{key:e}),t.url}}async doCacheMaintenanceLoop(){var e,t;if(!this.db)return void(this.cacheMaintenanceTimeoutId=setTimeout(this.doCacheMaintenanceLoop.bind(this),this.cacheMaintenanceInterval));const r=this.db;let n=await r.count("musicbrainz-covers")+await r.count("musicbrainz-cover-urls"),o=null!==(e=(await navigator.storage.estimate()).usage)&&void 0!==e?e:0;vt.debug(`Cache maintenance started   — Entries: ${n.toString().padEnd(4," ")} | Total Storage Used: ${Math.formatBytes(o,1)}`);const a=[];(await r.getAllKeysFromIndex("musicbrainz-covers","by-updatedDate",IDBKeyRange.upperBound(Date.now()-this.ttl))).forEach(e=>{a.push(new Promise(t=>{r.delete("musicbrainz-covers",e).then(()=>t(e))}))}),(await r.getAllKeysFromIndex("musicbrainz-cover-urls","by-updatedDate",IDBKeyRange.upperBound(Date.now()-this.ttl))).forEach(e=>{a.push(new Promise(t=>{r.delete("musicbrainz-cover-urls",e).then(()=>t(e))}))}),await Promise.all(a),n=await r.count("musicbrainz-covers")+await r.count("musicbrainz-cover-urls"),o=null!==(t=(await navigator.storage.estimate()).usage)&&void 0!==t?t:0,vt.info(`Cache maintenance completed — Entries: ${n.toString().padEnd(4," ")} | Total Storage Used: ${Math.formatBytes(o,1)}`),this.cacheMaintenanceTimeoutId=setTimeout(this.doCacheMaintenanceLoop.bind(this),this.cacheMaintenanceInterval)}hasExpired(e){return Date.now()-this.ttl>e}dispose(){clearTimeout(this.cacheMaintenanceTimeoutId)}}var ft=r(109),bt=r.n(ft);class mt{constructor(e,t){this.store=void 0,this.store=Object(dt.a)(e,t,{upgrade(e){e.createObjectStore("preferences")}})}async get(e){return(await this.store).get("preferences",e)}async set(e,t){(await this.store).put("preferences",t,e)}}const yt=Symbol("CANCEL");class wt{constructor(){this.isCancelled=void 0,this[yt]=void 0;let e=!1;this.isCancelled=()=>!0===e,this[yt]=()=>{e=!0}}}class Ot{constructor(){this.token=void 0,this.cancel=void 0,this.token=new wt,this.cancel=()=>this.token[yt]()}}var kt=r(58),_t=r.n(kt),St=r(212);function Ct(e){const{track:t,mbReleaseCoverArts:r,store:n,choosePreferredArtCallback:o}=e,a=Object(p.useCallback)(e=>{if(void 0===t)return;if(null===r||0===r.length)return;const a=pt(t);n.set(a,e);const i=r.find(t=>t.release===e);void 0!==i&&o(i)},[o,r,n,t]),i=Object(p.useMemo)(()=>null!==r&&r.length>1?r.map(t=>{const r=t.cover.reduce((e,t)=>t.size<e.size?t:e,t.cover[0]),n=e.currentMbReleaseCoverArt===t.release;return v.a.createElement("div",{key:t.release,className:n?"mb-cover selected":"mb-cover",onClick:n?void 0:()=>a(t.release)},v.a.createElement("img",{src:r.url,alt:"",width:64,height:64,style:{objectFit:"contain"}}),n?v.a.createElement("span",{className:"selected-mark"},v.a.createElement(Ie,{color:"#227F25"})):null)}):null,[r,a,e.currentMbReleaseCoverArt]);return null!==e.portalElementRef.current?_t.a.createPortal(v.a.createElement(St.a,{id:"mb-plac",style:{maxHeight:e.hidden?0:e.maxHeight,width:e.width}},v.a.createElement("div",{className:"mb-plac-content"},i)),e.portalElementRef.current):null}function jt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function xt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(r),!0).forEach((function(t){Rt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Rt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pt(e){const{mbClient:t,mbClientCache:r,fetchLocalCovers:n,preferrectLocalArtChooserElementRef:o,preferrectLocalArtChooserSize:a}=e,i=Object(p.useMemo)(()=>new mt("aleab.acav.preferred-covers",1),[]),l=Object(p.useMemo)(()=>{var t,r;if(e.track.is_local)return"";const n=null!==(t=bt()(e.track.album.images,t=>null!==t.width&&t.width>=e.width))&&void 0!==t?t:e.track.album.images[0];return null!==(r=null==n?void 0:n.url)&&void 0!==r?r:""},[e.track.album.id,e.track.is_local,e.width]),s=e.track.artists.join(", "),[c,u]=Object(p.useState)(""),[d,h]=Object(p.useState)(null),[g,f]=Object(p.useState)(null),b=Object(p.useMemo)(()=>{if(e.track.is_local)return{title:e.track.name,album:e.track.album.name,artists:e.track.artists.map(e=>e.name)}},[s,e.track.album.name,e.track.is_local,e.track.name]),m=Object(p.useRef)(new Ot),y=Object(p.useCallback)(t=>{if(null===t)u(""),f(null);else{var n;const o=t.cover.slice().sort((e,t)=>t.size-e.size),a=null!==(n=bt()(o,t=>null!==t.size&&t.size>=e.width))&&void 0!==n?n:o[0];void 0!==r?r.getCachedRealUrl(a.url).then(e=>{m.current.token.isCancelled()||(void 0!==e?u(e):fetch(a.url).then(e=>{m.current.token.isCancelled()||void 0!==r&&(r.cacheRealUrl(a.url,e.url),u(e.url))}))}):u(a.url),f(t.release)}},[r,e.width]);Object(p.useEffect)(()=>(m.current.cancel(),m.current=new Ot,n&&e.track.is_local&&void 0!==b&&(null==t||t.findCoverArtByReleaseGroup(b).then(e=>{null==e||0===e.length?(y(null),h(null)):i.get(pt(b)).then(t=>{const r=void 0===t?e[0]:e.find(e=>e.release===t);y(null!=r?r:e[0]),h(e)})})),()=>{u("")}),[n,b,t,i,e.track.is_local,y]);const w=Object(p.useMemo)(()=>e.track.is_local?c:l,[c,e.track.is_local,l]),O={width:e.width,height:e.width,objectFit:"contain",backgroundColor:w?void 0:"rgba(0, 0, 0, 0.1)"},[k,_]=Object(p.useState)(!1),S=Object(p.useCallback)(e=>y(e),[y]),C=Object(p.useMemo)(()=>void 0!==b&&null!==d&&d.length>1,[b,d]),j=Object(p.useMemo)(()=>({track:b,mbReleaseCoverArts:d,currentMbReleaseCoverArt:g,store:i,choosePreferredArtCallback:S,width:a.width,maxHeight:a.height,hidden:!k,portalElementRef:o}),[S,g,b,d,o,a.height,a.width,i,k]);Object(p.useEffect)(()=>{C||_(!1)},[C]);const x=Object(p.useCallback)(()=>_(!!C&&(e=>!e)),[C]),R=[];return C&&R.push("has-alt-covers"),e.className&&R.push(e.className),v.a.createElement(v.a.Fragment,null,v.a.createElement("div",{className:R.join(" "),style:xt({},e.style,{lineHeight:0}),onClick:x},v.a.createElement("img",{style:O,src:w,alt:""}),C?v.a.createElement("span",{className:k?"chevron up":"chevron"},v.a.createElement(Be,null)):null),v.a.createElement(Ct,j))}function Et(e,t=.4){const r=Y.a.rgb.hsv([e[0],e[1],e[2]]);return r[2]=r[2]>50?r[2]*(1-t):r[2]*(1+t),Y.a.hsv.rgb(r)}function Tt(e,t,r){return[Math.round(Math.lerp(e[0],t[0],r)),Math.round(Math.lerp(e[1],t[1],r)),Math.round(Math.lerp(e[2],t[2],r))]}function Mt(e){const t=Object(p.useMemo)(()=>{let t=e.color;const r=Object(ie.a)(e.color);if(void 0!==r){const e=Et([r[0],r[1],r[2]]);t=`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${r[3]})`}return t},[e.color]),r=void 0!==e.secondaryMessages?e.secondaryMessages.map(e=>e?v.a.createElement("div",{key:e,style:{color:t}},e):null):null;return v.a.createElement("div",{className:"error"},v.a.createElement("div",null,e.message),r)}var zt=r(4);class It{constructor(e,t,r,n){this.top=void 0,this.left=void 0,this.width=void 0,this.height=void 0,this.left=e,this.top=t,this.width=r,this.height=n}add(e,t,r,n){return new It(this.left+e,this.top+t,this.width+r,this.height+n)}}const Bt={hex:"#1ED760",rgb:[30,215,96]},Lt={hex:"#FFFFFF",rgb:[255,255,255]},At={hex:"#191414",rgb:[25,20,20]};function Nt(e,t,r,n,o,a,i,l){const s=e.getContext("2d");if(null===s)return Promise.reject();if(r.backgroundColor!==zt.i.backgroundColor.initialValue&&(s.save(),s.fillStyle=r.backgroundColor,s.fillRect(0,0,e.width,e.height),s.restore()),0===t.length)return Promise.resolve();const c=zt.c.parseBackgroundClip(r.backgroundClip),u=zt.c.parseBackgroundOrigin(r.backgroundOrigin),d=zt.c.parseBackgroundPosition(r.backgroundPosition),h=(zt.c.parseBackgroundRepeat(r.backgroundRepeat),zt.c.parseBackgroundSize(r.backgroundSize));let p=0;function v(e,r,n){p<t.length?n(e,r):e()}function g(r,f){if(l.isCancelled())return void f();if(null===s)return void f();const b=p;p++;const m=t[b];if(Object(zt.m)(m)){const t=new Image;t.onload=()=>{var m;if(l.isCancelled())return void f();if(null===s)return void f();const y={sx:0,sy:0,sw:t.naturalWidth,sh:t.naturalHeight,dx:n.left,dy:n.top,dw:t.naturalWidth,dh:t.naturalHeight},w=function(e,t,r){const n=1===u.length?u[0]:u[e];let i=t.width,l=t.height;if(void 0!==n)switch(n){case zt.b.BORDER_BOX:break;case zt.b.PADDING_BOX:r.dx+=o.left,r.dy+=o.top,i-=o.left+o.right,l-=o.top+o.bottom;break;case zt.b.CONTENT_BOX:r.dx+=o.left+a.left,r.dy+=o.top+a.top,i-=o.left+a.left+(o.right+a.right),l-=o.top+a.top+(o.bottom+a.bottom)}return new It(r.dx,r.dy,i,l)}(b,n,y);!function(e,t,r,n,o){if(void 0===(1===h.length?h[0]:h[e]))return;const[a,i]=Object(zt.j)(h[e],[r,n,r/n],t);o.dw=a,o.dh=i}(b,w,t.naturalWidth,t.naturalHeight,y),function(e,t,r,n,o,a){if(void 0===(1===d.length?d[0]:d[e]))return;const[l,s]=zt.g.getAbsoluteValueForTuple(d[e],t-n,r-o,i);a.dx+=l,a.dy+=s}(b,n.width,n.height,t.naturalWidth,t.naturalHeight,y),function(e,[t,r],n){if(n.dx<e.left){const r=e.left-n.dx;n.sx=r*(t/n.dw),n.sw=t-n.sx,n.dw-=r,n.dx=e.left}else n.dx>=e.right&&(n.sw=0);if(n.dy<e.top){const t=e.top-n.dy;n.sy=t*(r/n.dh),n.sh=r-n.sy,n.sw-=t,n.dy=e.top}else n.dy>=e.bottom&&(n.sh=0)}(n,[t.naturalWidth,t.naturalHeight],y);const O=null!==(m=1===c.length?c[0]:c[p])&&void 0!==m?m:zt.a.BORDER_BOX;if(O===zt.a.BORDER_BOX){if(l.isCancelled())return void f();s.drawImage(t,y.sx,y.sy,y.sw,y.sh,y.dx,y.dy,y.dw,y.dh)}else if(O===zt.a.PADDING_BOX||O===zt.a.CONTENT_BOX){const r=new OffscreenCanvas(e.width,e.height),i=r.getContext("2d");if(null!==i){if(i.drawImage(t,y.sx,y.sy,y.sw,y.sh,y.dx,y.dy,y.dw,y.dh),O===zt.a.PADDING_BOX?i.rect(n.left+o.left,n.top+o.top,n.width-o.left-o.right,n.height-o.top-o.bottom):i.rect(n.left+o.left+a.left,n.top+o.top+a.top,n.width-(o.left+a.left)-(o.right+a.right),n.height-(o.top+a.top)-(o.bottom+a.bottom)),i.clip(),l.isCancelled())return void f();s.drawImage(r,0,0,r.width,r.height,0,0,e.width,e.height)}}v(r,f,g)},t.onerror=()=>{l.isCancelled()?f():v(r,f,g)},t.src=m.url}else if(Object(zt.k)(m)){const[e,t,o,a,i]=zt.f.calculateGradientDirection(m.angle,n.width,n.height),l=s.createLinearGradient(n.left+t,n.top+a,n.left+o,n.top+i);zt.f.processColorStops(m.stops,e).forEach(e=>{l.addColorStop(e.stop,zt.e.asString(e.color))}),s.save(),s.fillStyle=l,s.fillRect(n.left,n.top,n.width,n.height),s.restore(),v(r,f,g)}else if(Object(zt.l)(m)){const e=0!==m.position.length?m.position:[{type:16,number:50,flags:4}],t=zt.g.getAbsoluteValue(e[0],n.width,i),o=zt.g.getAbsoluteValue(e[e.length-1],n.height,i),[a,l]=zt.f.calculateRadius(m,t,o,n.width,n.height);if(a>0&&l>0){const e=s.createRadialGradient(n.left+t,n.top+o,0,n.left+t,n.top+o,a);if(zt.f.processColorStops(m.stops,2*a).forEach(t=>{e.addColorStop(t.stop,zt.e.asString(t.color))}),s.save(),s.fillStyle=e,s.rect(n.left,n.top,n.width,n.height),a!==l){const e=n.left+.5*n.width,t=n.top+.5*n.height,r=l/a;s.translate(e,t),s.transform(1,0,0,r,0,0),s.translate(-e,-t),s.fillRect(n.left,(n.top-t)/r+t,n.width,n.height/r)}else s.fill();s.restore()}v(r,f,g)}}return new Promise((e,t)=>{l.isCancelled()?t():g(e,t)})}function Vt(e){const{borderTop:t,borderRight:r,borderBottom:n,borderLeft:o,paddingTop:a,paddingRight:i,paddingBottom:l,paddingLeft:s,fontSize:c}=getComputedStyle(e);return{border:{top:Number(t.slice(0,-2)),right:Number(r.slice(0,-2)),bottom:Number(n.slice(0,-2)),left:Number(o.slice(0,-2))},padding:{top:Number(a.slice(0,-2)),right:Number(i.slice(0,-2)),bottom:Number(l.slice(0,-2)),left:Number(s.slice(0,-2))},fontSize:Number(c.slice(0,-2))}}function Dt(e){const[t,r]=Object(p.useState)(Bt),n=Object(p.useRef)(null),o=Object(p.useRef)();Object(p.useEffect)(()=>{const e=(Math.round(1e3*Math.random())+Date.now()).toString(16);return o.current=zt.d.create(e,{allowTaint:!1,imageTimeout:15e3,proxy:void 0,useCORS:!1}),zt.h.create({id:e,enabled:!1}),()=>{zt.d.destroy(e),zt.h.destroy(e),o.current=void 0}},[]);const a=Object(p.useCallback)((e,t)=>null!==e&&null!==t&&q()(e,t)?e:t,[]),[i,l]=Object(p.useReducer)(a,Object(ie.b)(e.overlayHtmlRef.current)),[s,c]=Object(p.useReducer)(a,Object(ie.b)(e.backgroundHtmlRef.current)),u=Object(p.useCallback)((e,t=!1)=>{const n=Y.a.rgb.hsl(e);!t&&(n[2]<=3||function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(e,At.rgb)||n[2]>95)?r(Bt):r(function(e){return Y.a.rgb.lab(e)[0]<=45}(e)?Lt:At)},[]),d=Object(p.useMemo)(()=>new OffscreenCanvas(0,0),[]),h=Object(p.useCallback)(async(t,r,o)=>{if(o.isCancelled())return Promise.reject();if(null===t||null===r)return Promise.reject();if(null===e.backgroundHtmlRef.current||null===e.overlayHtmlRef.current)return Promise.reject();if(null===n.current)return Promise.reject();const a=d.getContext("2d");if(null!==a){const c=e.backgroundHtmlRef.current.getBoundingClientRect();i=d,l=c.width,s=c.height,i.height=s,i.width=l,a.clearRect(0,0,c.width,c.height);try{const n=zt.c.parseBackgroundImage(t.backgroundImage),{border:a,padding:i,fontSize:l}=Vt(e.backgroundHtmlRef.current);if(await Nt(d,n,t,c,a,i,l,o),o.isCancelled())return Promise.reject();const s=zt.c.parseBackgroundImage(r.backgroundImage),{border:u,padding:h,fontSize:p}=Vt(e.overlayHtmlRef.current);if(await Nt(d,s,r,e.overlayHtmlRef.current.getBoundingClientRect(),u,h,p,o),o.isCancelled())return Promise.reject()}catch(e){return g.a.error(e),Promise.reject()}const u=n.current.getBoundingClientRect(),{marginTop:h,marginRight:p,marginBottom:v,marginLeft:f}=getComputedStyle(n.current),b={top:Number(h.slice(0,-2)),right:Number(p.slice(0,-2)),bottom:Number(v.slice(0,-2)),left:Number(f.slice(0,-2))},m=a.getImageData(u.left-b.left,u.top-b.top,u.width+b.left+b.right,u.height+b.top+b.bottom),y=[0,0,0];for(let e=0;e<m.width;++e)for(let t=0;t<m.height;++t){const r=t*(4*m.width)+4*e;y[0]+=m.data[r+0],y[1]+=m.data[r+1],y[2]+=m.data[r+2]}const w=m.width*m.height;return y[0]/=w,y[1]/=w,y[2]/=w,y}var i,l,s;return[0,0,0]},[d,e.backgroundHtmlRef,e.overlayHtmlRef]),f=Object(p.useRef)(new Ot);return Object(p.useEffect)(()=>{if(void 0!==o.current&&null!==i&&null!==s)if(f.current.cancel(),f.current=new Ot,i.backgroundImage.toLowerCase()===zt.i.backgroundImage.initialValue){var e;const r=null!==(e=Object(ie.a)(i.backgroundColor))&&void 0!==e?e:[0,0,0,0];if(r[3]<1)if(s.backgroundImage.toLowerCase()===zt.i.backgroundImage.initialValue){var t;const e=null!==(t=Object(ie.a)(s.backgroundColor))&&void 0!==t?t:[0,0,0,0];let n=e.slice(0,3);e[3]<1&&(n=Tt([0,0,0],n,e[3])),n=Tt(n,r,r[3]),u(n)}else zt.d.attachInstance(o.current),h(s,i,f.current.token).then(e=>{u(e)}).catch(()=>{}).finally(()=>zt.d.detachInstance());else u(r)}else zt.d.attachInstance(o.current),h(s,i,f.current.token).then(e=>{u(e)}).catch(()=>{}).finally(()=>zt.d.detachInstance())},[o,u,i,h,s,d]),Object(p.useEffect)(()=>{l(Object(ie.b)(e.overlayHtmlRef.current)),c(Object(ie.b)(e.backgroundHtmlRef.current))}),v.a.createElement("span",{className:"spotify-icon",style:e.style,ref:n},v.a.createElement(Pe,{color:t.hex}))}var Ft=r(80),$t=r.n(Ft);function Wt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ht(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(r),!0).forEach((function(t){Gt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Gt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ut(e,t){return t>0?e/t*100:0}function qt(e){const t=Object(p.useMemo)(()=>"SpotifyOverlayProgressBar-"+(Math.random()*10**6).toFixed(6),[]),r=Object(p.useContext)(k),[n,o]=Object(p.useState)(Ut(e.progressMs,e.durationMs)),a=Object(p.useRef)(e.isPlaying),i=Object(p.useMemo)(()=>{let t;const r=Object(ie.a)(e.color);if(void 0!==r){let e=Et([r[0],r[1],r[2]],.6);if(void 0!==e){const n=Y.a.rgb.hsv([r[0],r[1],r[2]]),o=Y.a.rgb.hsv(e),a=n[2]-o[2];if(Math.abs(a)<15){const t=0===a?o[2]>50?-10:10:-Math.sign(a)*(10-Math.abs(a));o[2]=Math.clamp(o[2]+t,0,100),e=Y.a.hsv.rgb(o)}t=`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${r[3]})`}}return t},[e.color]);Object(p.useEffect)(()=>{a.current=e.isPlaying},[e.isPlaying]),Object(p.useEffect)(()=>{r.renderer.queue(t,()=>o(Ut(e.progressMs,e.durationMs)));let n=e.progressMs;const i=setInterval(()=>{a.current&&(n+=500,r.renderer.queue(t,()=>o(Ut(n,e.durationMs))))},500);return()=>{clearTimeout(i),r.renderer.cancel(t)}},[t,r.renderer,e.durationMs,e.progressMs]);const l=Object(p.useMemo)(()=>({"--bar-color":i,"--value-color":e.color}),[i,e.color]);return v.a.createElement("progress",{className:$t()(["progress-bar",e.className]," ").trim(),style:Ht({},l,{},e.style),max:100,value:n})}var Kt=r(42);const Jt={maxScroll:-1,msPerPixelScroll:50,startDelayMs:4e3,resetDelayMs:2e3,thresholdPx:0,render:e=>e(),cancelRender:()=>{},isScrolling:e=>e>0};function Xt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zt(e,t,r,n,o){var a,i;const l=Object(p.useRef)(0),[s,c]=Object(p.useState)(null!==(a=null===(i=t.current)||void 0===i?void 0:i.scrollWidth)&&void 0!==a?a:0);return Object(p.useEffect)(()=>{if(null!==e.current&&null!==t.current){const a=(o=e.current,Number(getComputedStyle(o).fontSize.slice(0,-2))),i=function(e){return Number(getComputedStyle(e).marginLeft.slice(0,-2))+Number(getComputedStyle(e).marginRight.slice(0,-2))}(e.current);e.current.innerHTML=r,a>0?(l.current=n*a,t.current.scrollWidth>t.current.offsetWidth?(c(t.current.scrollWidth-i+l.current),e.current.innerHTML=`${r}<span style="margin-left: ${l.current}px;">${r}</span>`):c(0)):c(void 0)}else c(void 0);var o},[e,r,n,t,...o]),[s,l.current]}function Qt(e,t,r,n,o,a){const i=Object(p.useRef)(null),l=Object(p.useRef)(null),[s,c]=Zt(i,l,e,o,a),u=Object(p.useCallback)(e=>e>0&&e<(null!=s?s:0)-c/2,[s,c]),[d,h,v]=function(e,t){var r,n,o,a,i,l,s,c;const u=G()({},Jt,t),d=u.isScrolling,h=null!==(r=null===(n=e.current)||void 0===n?void 0:n.scrollWidth)&&void 0!==r?r:0,v=null!==(o=null===(a=e.current)||void 0===a?void 0:a.scrollHeight)&&void 0!==o?o:0,g=null!==(i=null===(l=e.current)||void 0===l?void 0:l.offsetWidth)&&void 0!==i?i:0,f=null!==(s=null===(c=e.current)||void 0===c?void 0:c.scrollHeight)&&void 0!==s?s:0,[b,m]=Object(p.useState)(!1),y=Object(p.useMemo)(()=>u.maxScroll>=0?u.maxScroll:"x"===u.axis?h-g:v-f,[f,g,v,h,u.axis,u.maxScroll]),w=Object(p.useMemo)(()=>{const t=null!==e.current?getComputedStyle(e.current):void 0;return"x"===u.axis?"scroll"===(null==t?void 0:t.overflowX)&&y>u.thresholdPx:"scroll"===(null==t?void 0:t.overflowY)&&y>u.thresholdPx},[y,u.axis,u.thresholdPx,e]),O=Object(p.useRef)(u.msPerPixelScroll),k=Object(p.useRef)(u.startDelayMs),_=Object(p.useRef)(u.resetDelayMs),S=Object(p.useRef)("auto"===u.type?-k.current/O.current:0);Object(p.useEffect)(()=>{O.current=u.msPerPixelScroll},[u.msPerPixelScroll]),Object(p.useEffect)(()=>{k.current=u.startDelayMs},[u.startDelayMs]),Object(p.useEffect)(()=>{_.current=u.resetDelayMs},[u.resetDelayMs]);const C=Object(p.useRef)(!1),j=u.render,x=u.cancelRender,R=Object(p.useCallback)(t=>{if(C.current)return;const r=u.axis;j(()=>{null===e.current||C.current||e.current.scrollTo("x"===r?{left:t,behavior:"auto"}:{top:t,behavior:"auto"})})},[j,u.axis,e]),P=Object(p.useCallback)(t=>{if(null===e.current)return;const r="auto"===u.type?-k.current/O.current:0;m(!1),C.current=!0,x(),j(()=>{null!==e.current&&("x"===t?e.current.scrollLeft=r:e.current.scrollTop=r),C.current=!1}),S.current=r},[x,j,u.type,e]),E=Object(p.useRef)(0),T=Object(p.useCallback)(e=>{if(u.axis,u.type,w&&E.current<=0)if("manual"===u.type){const t=()=>{if(m(d(S.current)),S.current<y)E.current=setTimeout(t,O.current),R(++S.current);else{const t=()=>{P(u.axis),void 0!==e&&e(),E.current=0};_.current>0?E.current=setTimeout(t,_.current):t()}};t()}else if("auto"===u.type){const e=()=>{m(d(S.current)),E.current=setTimeout(e,O.current),S.current<y+_.current/O.current?R(++S.current):P(u.axis)};e()}},[d,P,R,w,y,u.axis,u.type]),M=Object(p.useCallback)(()=>{clearTimeout(E.current),P(u.axis),C.current=!1,E.current=0},[P,u.axis]);return Object(p.useEffect)(()=>{clearTimeout(E.current),C.current=!1,P(u.axis),E.current=0;const e=u.axis;return()=>{clearTimeout(E.current),C.current=!1,P(e),E.current=0}},[P,w,y,u.axis]),[T,M,b]}(l,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xt(Object(r),!0).forEach((function(t){Yt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({maxScroll:s,render:t,cancelRender:r,isScrolling:u},n));return[i,l,d,h,v]}function er(e){const t=Object(p.useMemo)(()=>({msPerPixelScroll:1e3/e.scrollSpeed,type:e.scrollType===Kt.a.Automatic?"auto":e.scrollType===Kt.a.OnMouseOver?"manual":"none",axis:"x",startDelayMs:1e3*e.scrollStartDelayMs,resetDelayMs:0}),[e.scrollSpeed,e.scrollStartDelayMs,e.scrollType]),[r,n,o,a,i]=Qt(e.text,e.render,e.cancelRender,t,e.loopMarginEm,[e.maxWidth,e.fontSize]);Object(p.useEffect)(()=>{e.scrollType===Kt.a.Automatic&&o()},[e.scrollType,o]);const l=Object(p.useCallback)(()=>{e.scrollType===Kt.a.OnMouseOver&&o()},[e.scrollType,o]),s=i?e.className+" scrolling":e.className;return v.a.createElement("div",{className:s,style:e.style,ref:n,onMouseOver:l,onFocus:l},v.a.createElement("span",{className:e.textClassName,style:e.textStyle,ref:r},e.text))}function tr(e){const t=Object(ie.a)(e);if(void 0===t)return e;const r=Et([t[0],t[1],t[2]],.4);return 1!==t[3]?`rgba(${r[0]},${r[1]},${r[2]},${t[3]})`:`rgb(${r[0]},${r[1]},${r[2]})`}function rr(e){const t=Object(p.useContext)(k),r=Object(p.useRef)(t.wallpaperProperties.spotify.scroll),[n,o]=Object(p.useState)(r.current.enabled),[a,i]=Object(p.useState)(r.current.type),[l,s]=Object(p.useState)(r.current.speed),[c,u]=Object(p.useState)(r.current.autoDelay);J(e=>{var t;return null===(t=e.spotify)||void 0===t?void 0:t.scroll},e=>{void 0!==e.enabled&&o(e.enabled),void 0!==e.type&&i(e.type),void 0!==e.speed&&s(e.speed),void 0!==e.autoDelay&&u(e.autoDelay)},[]);const d=Object(p.useMemo)(()=>"SpotifyOverlaySongInfo-ScrollTrack-"+(Math.random()*10**6).toFixed(6),[]),h=Object(p.useCallback)(e=>t.renderer.queue(d,e),[d,t.renderer]),g=Object(p.useCallback)(()=>t.renderer.cancel(d),[d,t.renderer]),f=Object(p.useMemo)(()=>{var t,r;return null!==(t=null===(r=e.currentlyPlaying.item)||void 0===r?void 0:r.name)&&void 0!==t?t:""},[e.currentlyPlaying.item]),b=Object(p.useMemo)(()=>"SpotifyOverlaySongInfo-ScrollArtists-"+(Math.random()*10**6).toFixed(6),[]),m=Object(p.useCallback)(e=>t.renderer.queue(b,e),[b,t.renderer]),y=Object(p.useCallback)(()=>t.renderer.cancel(b),[b,t.renderer]),w=Object(p.useMemo)(()=>null===e.currentlyPlaying.item?"":e.currentlyPlaying.item.artists.reduce((e,t)=>e?`${e}, ${t.name}`:t.name,""),[e.currentlyPlaying.item]),O=G()({},{width:e.width},e.style);return v.a.createElement("div",{className:$t()(["song-info",e.className]," ").trim(),style:O},v.a.createElement(er,{className:"lh-0 scrollable-x song-info-mask",textClassName:"song-info-field track",scrollType:!!n&&a,scrollSpeed:l,scrollStartDelayMs:c,loopMarginEm:2,text:f,maxWidth:e.width,fontSize:e.fontSize,render:h,cancelRender:g}),v.a.createElement(er,{className:"lh-0 scrollable-x song-info-mask",textClassName:"song-info-field artists",textStyle:{color:tr(e.color)},scrollType:!!n&&a,scrollSpeed:l,scrollStartDelayMs:c,loopMarginEm:2,text:w,maxWidth:e.width,fontSize:e.fontSize,render:m,cancelRender:y}))}function nr(){return(nr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function or(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ar(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?or(Object(r),!0).forEach((function(t){ir(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):or(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ir(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const lr=g.a.getLogger("Spofity","#1DB954");function sr(e){const t=Object(p.useContext)(k),r=Object(p.useRef)(t.wallpaperProperties.spotify),n=Object(p.useMemo)(()=>({get current(){return r.current.token}}),[]),o=Object(p.useRef)(void 0);Object(p.useEffect)(()=>(o.current=new gt(new ut(!1),{cacheName:"aleab.acav.mb-cache",ttlMs:Math.round(864e5*r.current.art.fetchLocalCacheMaxAge),cacheMaintenanceInterval:18e5}),o.current.init(),()=>{var e;null===(e=o.current)||void 0===e||e.dispose(),o.current=void 0}),[]);const[a,i]=Object(p.useState)(r.current.art.enabled),[l,s]=Object(p.useState)(r.current.art.type),[c,u]=Object(p.useState)(r.current.art.fetchLocalCovers),[d,h]=Object(p.useReducer)((e,t)=>q()(e,t)?e:G()({},e,t),{transform:Object(K.b)(r.current.style.pivot).transform,left:window.innerWidth*(r.current.style.left/100),top:window.innerHeight*(r.current.style.top/100),maxWidth:r.current.style.width,fontSize:r.current.style.fontSize,color:"#"+Y.a.rgb.hex(r.current.style.textColor)}),f=Object(p.useCallback)(()=>Object(C.b)(r.current.style.background.mode,{color:r.current.style.background.color,alpha:r.current.style.background.colorAlpha/100,css:r.current.style.background.css}),[]),[b,y]=Object(p.useReducer)(f,void 0,f),[w,O]=Object(p.useState)(r.current.progressBar.enabled),[_,S]=Object(p.useState)("#"+Y.a.rgb.hex(r.current.progressBar.color)),[j,x]=Object(p.useState)(r.current.progressBar.position),[R,P,E]=Object(de.useMachine)(Ye.withContext({token:n,backendUrl:"https://toastify.herokuapp.com/api/acav"}));Object(p.useEffect)(()=>(window.acav.refreshSpotifyToken=function(){const e=localStorage.getItem("aleab.acav.spotify");if(null!==e){const t=JSON.parse(e);t.expires_at=Date.now()+5,localStorage.setItem("aleab.acav.spotify",JSON.stringify(t)),E.send(qe.SpotifyTokenExpired)}},()=>{delete window.acav.refreshSpotifyToken}),[E]),Object(p.useEffect)(()=>{P(qe.Init),lr.info("Registering StateMachine's state listener...");const e=new Map,t=E.subscribe(t=>{switch(t.value){case Ue.S5HasATIdle:{const r=t.context.spotifyToken.expires_at-Date.now()-1e4||0,n=r>=0?r:0;clearTimeout(e.get("refreshTimeoutId"));const o=setTimeout(()=>{e.delete("refreshTimeoutId"),P(qe.SpotifyTokenExpired)},n);e.set("refreshTimeoutId",o),lr.debug(`Scheduled next token refresh in ${Math.round(n/1e3)} seconds.`);break}case Ue.S6CantGetTokenErrorIdle:case Ue.S7RetryWaiting:break;case Ue.SNNoInternetConnection:{const t=()=>P(qe.InternetConnectionRestored),r=()=>{clearTimeout(e.get("retryTimeoutId"));const n=setTimeout(()=>{e.delete("retryTimeoutId"),Le(t,r)},2e3);e.set("retryTimeoutId",n)};Le(t,r);break}}});return()=>{t.unsubscribe(),e.forEach((e,t)=>{clearTimeout(e),lr.debug(`Timeout cancelled: ${t} (#${e})`)})}},[P,E]),J(e=>e.spotify,e=>{if(void 0!==e.backendURL)if(e.backendURL)try{new URL(e.backendURL);R.context.backendUrl=e.backendURL}catch{R.context.backendUrl="https://toastify.herokuapp.com/api/acav"}else R.context.backendUrl="https://toastify.herokuapp.com/api/acav";if(void 0!==e.token&&e.token&&P(qe.UserEnteredToken),void 0!==e.art&&(void 0!==e.art.enabled&&i(e.art.enabled),void 0!==e.art.type&&s(e.art.type),void 0!==e.art.fetchLocalCovers&&u(e.art.fetchLocalCovers),void 0!==e.art.fetchLocalCacheMaxAge&&void 0!==o.current&&(o.current.ttl=Math.round(864e5*e.art.fetchLocalCacheMaxAge))),void 0!==e.style){const t={};void 0!==e.style.pivot&&(t.transform=Object(K.b)(e.style.pivot).transform),void 0!==e.style.left&&(t.left=window.innerWidth*(e.style.left/100)),void 0!==e.style.top&&(t.top=window.innerHeight*(e.style.top/100)),void 0!==e.style.width&&(t.maxWidth=e.style.width),void 0!==e.style.fontSize&&(t.fontSize=e.style.fontSize),void 0!==e.style.textColor&&(t.color="#"+Y.a.rgb.hex(e.style.textColor)),void 0!==e.style.background&&y(),h(t)}void 0!==e.progressBar&&(void 0!==e.progressBar.enabled&&O(e.progressBar.enabled),void 0!==e.progressBar.color&&S("#"+Y.a.rgb.hex(e.progressBar.color)),void 0!==e.progressBar.position&&x(e.progressBar.position))},[P]);const[T,M]=Object(p.useState)(void 0),[z,I]=Object(p.useState)(0),B=Object(p.useCallback)(()=>R.value===Ue.S5HasATIdle,[R.value]),L=Object(p.useCallback)(()=>P(qe.SpotifyTokenExpired),[P]),A=Object(p.useCallback)(()=>P(qe.NoInternetConnection),[P]);!function(e,t,r,n,o,a,i,l,s,c){const u=Object(p.useMemo)(()=>void 0!==c?c:g.a.getLogger("useSpotifySmartTrackRefresh","#1DB954"),[c]),d=Object(p.useCallback)((e,t)=>{var r,n,o,a,i,l,s,c;return(null!==(r=null==t||null===(n=t.item)||void 0===n||null===(o=n.external_urls)||void 0===o?void 0:o.spotify)&&void 0!==r?r:null==t||null===(a=t.item)||void 0===a?void 0:a.uri)!==(null!==(i=null==e||null===(l=e.item)||void 0===l||null===(s=l.external_urls)||void 0===s?void 0:s.spotify)&&void 0!==i?i:null==e||null===(c=e.item)||void 0===c?void 0:c.uri)&&u.debug("Currently playing:",t),t},[u]),h=Object(p.useRef)(0),v=Object(p.useRef)(0),f=Object(p.useRef)(0),b=Object(p.useRef)(0);Object(p.useEffect)(()=>{if(void 0===e)return;let c=!1;const p=async()=>{if(o()&&!(f.current>=Date.now()))if(!n||n.expires_at<Date.now())null==l||l();else{const t=await fetch("https://api.spotify.com/v1/me/player/currently-playing?market=from_token",{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+n.access_token}}).catch(e=>null);if(c)return;if(!t)return void(null==s||s());i(t.status);let r=0;switch(t.status){case 200:t.json().then(e=>{a(t=>d(t,e))});break;case 204:a(e=>d(e,null)),r=0===b.current?Date.now():b.current;break;case 401:t.json().then(e=>u.warn("/currently-playing returned 401:",e)),null==l||l();break;case 429:{var e;const r=Number(null!==(e=t.headers.get("Retry-After"))&&void 0!==e?e:4)+1;u.warn(`Rate Limit reached; retry after ${r}s!`),f.current=Date.now()+1e3*r;break}default:a(e=>d(e,null)),t.json().then(e=>u.error(`/currently-playing returned ${t.status}:`,e))}b.current=r}},g=(e,t=!1)=>{let n=r;b.current>0&&Date.now()>=b.current+12e4&&(t||(n*=2)),e>=h.current+n&&(h.current=e,p())},y=e=>{b.current>0&&Date.now()>=b.current+12e4?g(e):e>=v.current+t&&(v.current=e,h.current=e,setTimeout(()=>p(),100))};let w=0;new m(5);const O=e=>{const t=Date.now(),r=e.mean;w>0?r<=7.315e-7||(w=0,y(t)):r<=7.315e-7?(w=t,y(t)):g(t)};return e.wallpaperEvents.onAudioSamples.subscribe(O),()=>{c=!0,e.wallpaperEvents.onAudioSamples.unsubscribe(O)}},[u,o,e,s,r,a,d,i,t,n,l])}(t,750,5e3,R.context.spotifyToken,B,M,I,L,A,lr);const N=Object(p.useMemo)(()=>R.value===Ue.S4CheckingAT,[R.value]),V=Object(p.useMemo)(()=>{var e;if(429===z)return!0;if(R.value!==Ue.S7RetryWaiting)return!1;const t=null===(e=R.event.data)||void 0===e?void 0:e.event;return t&&429===t.status},[z,R.event.data,R.value]),D=Object(p.useMemo)(()=>R.value===Ue.S6CantGetTokenErrorIdle,[R.value]),F=Object(p.useMemo)(()=>R.value===Ue.SNNoInternetConnection,[R.value]),$=Object(p.useRef)(null),[W,H]=Object(p.useState)({left:0,top:0}),U=Object(p.useMemo)(()=>({width:224,maxHeight:152}),[]),[X,Z,Q]=function(){const[e,t]=Object(p.useState)(null),r=Object(p.useRef)(null),n=Object(p.useCallback)(e=>{r.current=e,null!==e&&t(e.getBoundingClientRect())},[]);return[e,r,n]}();Object(p.useEffect)(()=>{if(d.left,d.top,d.maxWidth,d.fontSize,d.transform,null!==X){let e=X.left,t=X.bottom;const r=[];X.left+U.width>=window.innerWidth-20&&(e=X.right,r.push("translateX(-100%)")),X.bottom+U.maxHeight>=window.innerHeight-20&&(t=X.top,r.push("translateY(-100%)")),H(n=>ar({},n,{left:e,top:t,transform:r.join(" ")}))}},[d.fontSize,d.left,d.maxWidth,d.top,d.transform,U.maxHeight,U.width,X]);const ee=Object(p.useCallback)(()=>{const e=v.a.createElement("span",{className:"state-icons"},N?v.a.createElement("span",null,v.a.createElement(Ee,{className:"fa-spin",color:"hsla(0, 0%, 100%, 0.69)"})):null,V?v.a.createElement("span",null,v.a.createElement(Te,{color:"hsla(45, 100%, 50%, 0.69)"})):null,D?v.a.createElement("span",null,v.a.createElement(ze,{color:"hsla(0, 100%, 32%, 0.69)"})):null,F?v.a.createElement("span",null,v.a.createElement(Me,{className:"blink",color:"hsla(0, 100%, 32%, 0.69)"})):null);return Array.isArray(e.props.children)?e.props.children.filter(e=>null!=e).length>0?e:null:null!==e.props.children&&void 0!==e.props.children?e:null},[F,D,V,N]);switch(R.value){case Ue.S4CheckingAT:case Ue.S5HasATIdle:{var te,re,ne,oe;if(void 0===T)return null;const t={ref:Q,id:"spotify",className:"overlay d-flex flex-column flex-nowrap align-items-start overflow-hidden",style:ar({},d,{},b)},r={className:"main d-flex flex-row flex-nowrap align-items-center overflow-hidden",style:{maxWidth:d.maxWidth}},n={currentlyPlaying:T,width:d.maxWidth,color:d.color,fontSize:d.fontSize},i={color:_,isPlaying:null!==(te=null==T?void 0:T.is_playing)&&void 0!==te&&te,durationMs:null!==(re=null==T||null===(ne=T.item)||void 0===ne?void 0:ne.duration_ms)&&void 0!==re?re:0,progressMs:null!==(oe=null==T?void 0:T.progress_ms)&&void 0!==oe?oe:0,className:""+(j===Ae.a.Top?"top":"bottom")};if(null===(null==T?void 0:T.item)||void 0===(null==T?void 0:T.item))return v.a.createElement("div",t,v.a.createElement(Dt,{overlayHtmlRef:Z,backgroundHtmlRef:e.backgroundElement}),v.a.createElement(ee,null));if(!a)return v.a.createElement("div",t,v.a.createElement(ee,null),w?v.a.createElement(qt,i):null,v.a.createElement("div",r,v.a.createElement(rr,nr({},n,{style:{marginLeft:"1em"}}))));switch(l){case Ne.a.AlbumArt:{const e=4*d.fontSize-.5*d.fontSize;return v.a.createElement(v.a.Fragment,null,v.a.createElement("div",t,v.a.createElement(ee,null),w?v.a.createElement(qt,i):null,v.a.createElement("div",r,v.a.createElement(Pt,{className:"flex-shrink-0",style:{margin:".25em"},width:e,track:T.item,fetchLocalCovers:c,mbClient:o.current,mbClientCache:o.current,preferrectLocalArtChooserElementRef:$,preferrectLocalArtChooserSize:{width:U.width,height:U.maxHeight}}),v.a.createElement(rr,nr({},n,{className:"align-self-start",style:{marginLeft:".25em"}})))),v.a.createElement("div",{ref:$,style:ar({position:"absolute"},U,{},W)}))}case Ne.a.SpotifyIcon:return v.a.createElement("div",t,v.a.createElement(ee,null),w?v.a.createElement(qt,i):null,v.a.createElement("div",r,v.a.createElement(Dt,{overlayHtmlRef:Z,backgroundHtmlRef:e.backgroundElement}),v.a.createElement(rr,n)));default:return null}}case Ue.S6CantGetTokenErrorIdle:{var ae;const t="Fatal error while exchanging token!",r=null===(ae=R.event.data)||void 0===ae?void 0:ae.event,n=(null==r?void 0:r.error)?[null==r?void 0:r.error]:[];return n.push("Enter a new token"),v.a.createElement("div",{id:"spotify",className:"d-flex flex-nowrap align-items-start overlay",style:ar({},d,{},b,{width:d.maxWidth})},v.a.createElement(Dt,{overlayHtmlRef:Z,backgroundHtmlRef:e.backgroundElement}),v.a.createElement(Mt,{message:t,secondaryMessages:n,color:d.color}),v.a.createElement(ee,null))}case Ue.S7RetryWaiting:{var ie;const t="Couldn't refresh token; retrying shortly...",r=null===(ie=R.event.data)||void 0===ie?void 0:ie.event;return v.a.createElement("div",{id:"spotify",className:"d-flex flex-nowrap align-items-start overlay",style:ar({},d,{},b,{width:d.maxWidth})},v.a.createElement(Dt,{overlayHtmlRef:Z,backgroundHtmlRef:e.backgroundElement}),v.a.createElement(Mt,{message:t,secondaryMessages:(null==r?void 0:r.error)?[null==r?void 0:r.error]:void 0,color:d.color}),v.a.createElement(ee,null))}default:return null}}var cr=r(11);class ur{constructor(e,t,r){this.context=void 0,this.canvas=void 0,this.options=void 0,this.context=e,this.canvas=t,this.options=r}setCanvasColor(e,t){void 0!==t&&(e.setFillColorRgb(t),e.setStrokeColorRgb(t))}computeFillColor(e,t,r,n,o){const a=[r,r];if(void 0!==t.samples){const r=t.samples.getSample(e);if(void 0!==n){const i=o([r[0],r[1]],e,{samplesBuffer:t.samplesBuffer,peak:t.peak});Number.isNaN(i[0])||Number.isNaN(i[1])||(a[0]=n(i[0]),a[1]=n(i[1]))}}return a}render(e){var t;const r=null===(t=this.canvas.current)||void 0===t?void 0:t.getContext("2d");if(!r)return null;let n=null;var o;if(r.clearRect(0,0,r.canvas.width,r.canvas.height),this.context.wallpaperProperties.audioprocessing){if(e.samples){const t=2*e.samples.length,o=this.options.visualizerOptions,a=this.options.commonOptions,i=o.current.flipFrequencies,l=r.canvas.height*(a.position/100),s=r.canvas.width*(a.width/100),c=a.alignment,u=[a.color[0],a.color[1],a.color[2]],d=o.current.responseType!==x.b.None?x.a.buildColorReaction(o.current.responseType,{fromRgb:u,toRgb:[o.current.responseToHue[0],o.current.responseToHue[1],o.current.responseToHue[2]],degree:o.current.responseDegree,range:o.current.responseRange}):void 0,h=R.b.buildAudioResponsiveValueProvider(o.current.responseProvider,o.current.responseValueGain),p=Math.min(2/(1-c)*l,2/(1+c)*(r.canvas.height-l)),v=this.getHeight(p);void 0===d&&this.setCanvasColor(r,u),this.renderSamples(e,{canvasContext:r,N:t,flipFrequencies:i,visualizerPosition:l,visualizerWidth:s,alignment:c,height:v,colorRgb:u,colorReaction:d,colorReactionValueProvider:h}),n={samples:e.samples,color:u,colorReactionType:o.current.responseType,colorReaction:d,colorResponseValueGain:o.current.responseValueGain}}}else null===(o=e.samples)||void 0===o||o.clear();return n}}function dr(e,t,r,n,o,a){const i=a>n/2?n/2:a;o>1&&i>0?(e.beginPath(),o>2*i?(e.rect(t,r+i,n,o-2*i),e.arc(t+i,r+i,i,-Math.PI,-Math.PI_2),e.arc(t+n-i,r+i,i,-Math.PI_2,0),e.arc(t+n-i,r+o-i,i,0,Math.PI_2),e.arc(t+i,r+o-i,i,Math.PI_2,Math.PI),i<n/2&&(e.rect(t+i,r,n-2*i,i),e.rect(t+i,r+o-i,n-2*i,i))):(e.ellipse(t+i,r+o/2,i,o/2,0,Math.PI_2,3*Math.PI_2),e.ellipse(t+n-i,r+o/2,i,o/2,0,-Math.PI_2,Math.PI_2)),e.fill()):e.fillRect(t,r,n,o)}class hr extends ur{getHeight(e){return e*(this.options.options.height/100)}renderSamples(e,t){if(void 0===e.samples)return;const r=this.options.options,{canvasContext:n,N:o,flipFrequencies:a,visualizerPosition:i,visualizerWidth:l,alignment:s,height:c,colorRgb:u,colorReaction:d,colorReactionValueProvider:h}=t,p=l/o*(r.width/100),v=p/2*(r.borderRadius/100),g=(l-o*p)/(o-1);e.samples.forEach((t,r)=>{if(0===t[0]&&0===t[1])return;const o=[n.canvas.height-i-.5*(1+s)*(t[0]*c),n.canvas.height-i-.5*(1+s)*(t[1]*c)],l=a?e.samples.length-1-r:r,f=g/2+l*(p+g),b=this.computeFillColor(r,e,u,d,h);n.save(),0!==t[0]&&(n.setFillColorRgb(b[0]),n.setStrokeColorRgb(b[0]),dr(n,n.canvas.width/2-f-p,o[0],p,t[0]*c,v)),0!==t[1]&&(b.length>0&&(n.setFillColorRgb(b[1]),n.setStrokeColorRgb(b[1])),dr(n,n.canvas.width/2+f,o[1],p,t[1]*c,v)),n.restore()})}}function pr(e,t,r,n,o,a){e.fillRect(t,r-a,n,a),e.fillRect(t,r+o,n,a)}class vr extends ur{getHeight(e){return e*(this.options.options.height/100)}renderSamples(e,t){if(void 0===e.samples)return;const r=this.options.options,{canvasContext:n,N:o,flipFrequencies:a,visualizerPosition:i,visualizerWidth:l,alignment:s,height:c,colorRgb:u,colorReaction:d,colorReactionValueProvider:h}=t,p=l/o*(r.width/100),v=r.thickness,g=(l-o*p)/(o-1);e.samples.forEach((t,r)=>{if(0===t[0]&&0===t[1])return;const o=[n.canvas.height-i-.5*(1+s)*(t[0]*c),n.canvas.height-i-.5*(1+s)*(t[1]*c)],l=a?e.samples.length-1-r:r,f=g/2+l*(p+g),b=this.computeFillColor(r,e,u,d,h);n.save(),0!==t[0]&&(n.setFillColorRgb(b[0]),n.setStrokeColorRgb(b[0]),pr(n,n.canvas.width/2-f-p,o[0],p,t[0]*c,v)),0!==t[1]&&(b.length>0&&(n.setFillColorRgb(b[1]),n.setStrokeColorRgb(b[1])),pr(n,n.canvas.width/2+f,o[1],p,t[1]*c,v)),n.restore()})}}function gr(e,t){e.lineCap="round",e.lineJoin="round",e.lineWidth=t,e.stroke()}function fr(e,t,r,n){return n<=0?[e,t]:[{x:Math.lerp(e.x,t.x,.5*n),y:Math.lerp(e.y,t.y,.5*n)},null!==r?{x:Math.lerp(t.x,r.x,.5*n),y:Math.lerp(t.y,r.y,.5*n)}:t]}function br(e,t,r,n,o,a){a<=0?e.lineTo(r.x,r.y):null!==n?e.quadraticCurveTo(r.x,r.y,o.x,o.y):e.quadraticCurveTo(t.x,t.y,r.x,r.y)}function mr(e,t,r,n,o,a,i,l,s,c,u){if(null===c)return;e.beginPath();const d=o>=0?{x:t,y:r}:{x:t,y:r+n},h=o>=0?{x:c.x,y:c.y}:{x:c.x,y:c.y+c.height},p=null!==u?o>=0?{x:u.x,y:u.y}:{x:u.x,y:u.y+u.height}:null,[v,g]=fr(h,d,p,i);if(e.moveTo(v.x,v.y),br(e,h,d,p,g,i),l){const l=o>=0?{x:t,y:r+n}:{x:t,y:r},p=o>=0?{x:c.x,y:c.y+c.height}:{x:c.x,y:c.y},f=null!==u?o>=0?{x:u.x,y:u.y+u.height}:{x:u.x,y:u.y}:null,b=Math.sqrt((h.x-p.x)**2+(h.y-p.y)**2),m=Math.sqrt((d.x-l.x)**2+(d.y-l.y)**2),y=s&&(b>=1||m>=1),[w,O]=fr(p,l,f,i);y?(e.lineTo(O.x,O.y),e.closePath(),e.fill(),e.moveTo(v.x,v.y),e.lineTo(w.x,w.y),br(e,p,l,f,O,i),e.closePath(),e.fill(),e.moveTo(g.x,g.y),e.lineTo(O.x,O.y),gr(e,1)):(e.moveTo(w.x,w.y),br(e,p,l,f,O,i),gr(e,a))}else gr(e,a)}class yr extends ur{getHeight(e){return e*(this.options.options.height/100)}getSampleRenderProps(e,t,r,n,o){if(t>=e.length)return null;const a=e.getSample(t),{canvasContext:i,flipFrequencies:l,visualizerPosition:s,alignment:c,height:u,colorRgb:d,colorReaction:h,colorReactionValueProvider:p}=r,v=[i.canvas.height-s-.5*(1+c)*(a[0]*u),i.canvas.height-s-.5*(1+c)*(a[1]*u)],g=o/2+(l?e.length-1-t:t)*o;return{fillColor:this.computeFillColor(t,n,d,h,p),position:[{x:i.canvas.width/2-g,y:v[0]},{x:i.canvas.width/2+g,y:v[1]}],height:[a[0]*u,a[1]*u]}}renderSamples(e,t){if(void 0===e.samples)return;const r=this.options.options,{canvasContext:n,N:o,visualizerWidth:a,alignment:i}=t,l=r.thickness,s=r.smoothness,c=r.showMirrorWave,u=r.fill,d=a/o;let h=null;e.samples.forEach((r,o,a)=>{if(0===r[0]&&0===r[1])return;const p=this.getSampleRenderProps(a,o,t,e,d);if(null===p)return;const{fillColor:v,position:g,height:f}=p,b=[{x:g[0].x,y:g[0].y,height:f[0]},{x:g[1].x,y:g[1].y,height:f[1]}],m=this.getSampleRenderProps(a,o+1,t,e,d),y=null!==m?[{x:m.position[0].x,y:m.position[0].y,height:m.height[0]},{x:m.position[1].x,y:m.position[1].y,height:m.height[1]}]:null;var w,O,k,_,S,C,j,x;(n.save(),0!==r[0])&&(n.setFillColorRgb(v[0]),n.setStrokeColorRgb(v[0]),mr(n,b[0].x,b[0].y,b[0].height,i,l,s,c,u,null!==(w=null===(O=h)||void 0===O?void 0:O[0])&&void 0!==w?w:null,null!==(k=null==y?void 0:y[0])&&void 0!==k?k:null));0!==r[1]&&(v.length>0&&(n.setFillColorRgb(v[1]),n.setStrokeColorRgb(v[1])),mr(n,b[1].x,b[1].y,b[1].height,i,l,s,c,u,null!==(_=null===(S=h)||void 0===S?void 0:S[1])&&void 0!==_?_:null,null!==(C=null==y?void 0:y[1])&&void 0!==C?C:null));(h=b,0===o)&&(mr(n,b[0].x,b[0].y,b[0].height,i,l,s,c,u,b[1],null!==(j=null==y?void 0:y[0])&&void 0!==j?j:null),mr(n,b[1].x,b[1].y,b[1].height,i,l,s,c,u,b[0],null!==(x=null==y?void 0:y[1])&&void 0!==x?x:null));n.restore()})}}function wr(e,t,r,n,o){const a=n;let i;switch(o){case cr.b.Bars:i=new hr(e,t,{visualizerOptions:r,get commonOptions(){return a.current},get options(){return a.current.bars}});break;case cr.b.Blocks:i=new vr(e,t,{visualizerOptions:r,get commonOptions(){return a.current},get options(){return a.current.blocks}});break;case cr.b.Wave:i=new yr(e,t,{visualizerOptions:r,get commonOptions(){return a.current},get options(){return a.current.wave}})}return void 0===i?()=>null:i.render.bind(i)}class Or{constructor(e,t,r){this.context=void 0,this.canvas=void 0,this.options=void 0,this.context=e,this.canvas=t,this.options=r}setCanvasColor(e,t){void 0!==t&&(e.setFillColorRgb(t),e.setStrokeColorRgb(t))}computeFillColor(e,t,r,n,o){const a=[r,r];if(void 0!==t.samples){const r=t.samples.getSample(e);if(void 0!==n){const i=o([r[0],r[1]],e,{samplesBuffer:t.samplesBuffer,peak:t.peak});Number.isNaN(i[0])||Number.isNaN(i[1])||(a[0]=n(i[0]),a[1]=n(i[1]))}}return a}render(e){var t;const r=null===(t=this.canvas.current)||void 0===t?void 0:t.getContext("2d");if(!r)return null;let n=null;var o;if(r.clearRect(0,0,r.canvas.width,r.canvas.height),this.context.wallpaperProperties.audioprocessing){if(e.samples){const t=2*e.samples.length,o=this.options.visualizerOptions,a=this.options.commonOptions,i=Math.min(r.canvas.width,r.canvas.height),l=a.angle,s=l/180*Math.PI/t,c=o.current.flipFrequencies,u=r.canvas.width*(a.x/100),d=r.canvas.height*(a.y/100),h=i*(a.radius/100),p=a.rotation/180*Math.PI,v=[a.color[0],a.color[1],a.color[2]],g=o.current.responseType!==x.b.None?x.a.buildColorReaction(o.current.responseType,{fromRgb:v,toRgb:[o.current.responseToHue[0],o.current.responseToHue[1],o.current.responseToHue[2]],degree:o.current.responseDegree,range:o.current.responseRange}):void 0,f=R.b.buildAudioResponsiveValueProvider(o.current.responseProvider,o.current.responseValueGain),b=Math.clamp(i/2-h,0,i/2),m=this.getHeight(b);void 0===g&&this.setCanvasColor(r,v),this.renderSamples(e,{canvasContext:r,N:t,visualizerAngle:l,angularDelta:s,flipFrequencies:c,x:u,y:d,radius:h,rotation:p,height:m,colorRgb:v,colorReaction:g,colorReactionValueProvider:f}),n={samples:e.samples,color:v,colorReactionType:o.current.responseType,colorReaction:g,colorResponseValueGain:o.current.responseValueGain}}}else null===(o=e.samples)||void 0===o||o.clear();return n}}function kr(e,t,r,n,o){const{x:a,y:i}=n,l=o/2,s=Math.cos(Math.PI_2-t),c=Math.sin(Math.PI_2-t),u=(r+e)*Math.cos(t)+a,d=(r+e)*Math.sin(t)-i;return[{x:u-l*s,y:d+l*c},{x:u+l*s,y:d-l*c}]}function _r(e,t,r,n,o,a,i){const l=-(o-Math.PI_2),s=kr(0,l,n,{x:t,y:r},a);if(i>=1){const o=kr(i,l,n,{x:t,y:r},a);e.beginPath(),e.moveTo(s[0].x,-s[0].y),e.lineTo(s[1].x,-s[1].y),e.lineTo(o[1].x,-o[1].y),e.lineTo(o[0].x,-o[0].y),e.closePath(),e.fill()}else e.lineCap="butt",e.lineWidth=1,e.beginPath(),e.moveTo(s[0].x,-s[0].y),e.lineTo(s[1].x,-s[1].y),e.stroke()}class Sr extends Or{getHeight(e){return e*(this.options.options.height/100)}renderSamples(e,t){if(void 0===e.samples)return;const r=this.options.options,{canvasContext:n,N:o,angularDelta:a,flipFrequencies:i,x:l,y:s,radius:c,rotation:u,height:d,colorRgb:h,colorReaction:p,colorReactionValueProvider:v}=t,g=2*c*Math.sin(a/2)*(r.width/100);e.samples.forEach((t,r)=>{const o=i?e.samples.length-1-r:r,f=a/2+o*a,b=this.computeFillColor(r,e,h,p,v);n.save(),n.setFillColorRgb(b[0]),n.setStrokeColorRgb(b[0]),_r(n,l,s,c,u-f,g,t[0]*d),b.length>0&&(n.setFillColorRgb(b[1]),n.setStrokeColorRgb(b[1])),_r(n,l,s,c,u+f,g,t[1]*d),n.restore()})}}function Cr(e,t,r,n,o,a,i,l){const s=-(o-Math.PI_2),c=kr(0,s,n,{x:t,y:r},a),u=kr(i,s,n,{x:t,y:r},a),d=kr(i+l,s,n,{x:t,y:r},a);e.lineCap="butt",e.lineWidth=1,e.beginPath(),e.moveTo(c[0].x,-c[0].y),e.lineTo(c[1].x,-c[1].y),e.stroke(),e.beginPath(),e.moveTo(u[0].x,-u[0].y),e.lineTo(u[1].x,-u[1].y),e.lineTo(d[1].x,-d[1].y),e.lineTo(d[0].x,-d[0].y),e.closePath(),e.fill()}class jr extends Or{getHeight(e){return e*(this.options.options.height/100)}renderSamples(e,t){if(void 0===e.samples)return;const r=this.options.options,{canvasContext:n,N:o,angularDelta:a,flipFrequencies:i,x:l,y:s,radius:c,rotation:u,height:d,colorRgb:h,colorReaction:p,colorReactionValueProvider:v}=t,g=2*c*Math.sin(a/2)*(r.width/100),f=r.thickness;e.samples.forEach((t,r)=>{const o=i?e.samples.length-1-r:r,b=a/2+o*a,m=this.computeFillColor(r,e,h,p,v);n.save(),n.setFillColorRgb(m[0]),n.setStrokeColorRgb(m[0]),Cr(n,l,s,c,u-b,g,t[0]*d,f),m.length>0&&(n.setFillColorRgb(m[1]),n.setStrokeColorRgb(m[1])),Cr(n,l,s,c,u+b,g,t[1]*d,f),n.restore()})}}function xr(e,t,r){const{x:n,y:o}=t;return{x:e*Math.cos(r)+n,y:-(e*Math.sin(r)-o)}}function Rr(e,t,r,n,o,a,i,l,s,c,u,d){if(null===u)return;e.beginPath();const h=-(a-Math.PI_2),p=-(u.angle-Math.PI_2),v=null!==d?-(d.angle-Math.PI_2):void 0,g=xr(n+o,{x:t,y:r},h),f=xr(n+u.height,{x:t,y:r},p),b=null!==d?xr(n+d.height,{x:t,y:r},v):null,[m,y]=fr(f,g,b,l);if(e.moveTo(m.x,m.y),br(e,f,g,b,y,l),s){const a=Math.clamp(o/2,0,n/2),s=Math.clamp(u.height/2,0,n/2),g=xr(n-a,{x:t,y:r},h),f=xr(n-s,{x:t,y:r},p),b=null!==d?xr(n-Math.clamp(d.height/2,0,n/2),{x:t,y:r},v):null,w=s+u.height,O=a+o,k=c&&(w>=1||O>=1),[_,S]=fr(f,g,b,l);k?(e.lineTo(S.x,S.y),e.closePath(),e.fill(),e.moveTo(m.x,m.y),e.lineTo(_.x,_.y),br(e,f,g,b,S,l),e.closePath(),e.fill(),e.moveTo(y.x,y.y),e.lineTo(S.x,S.y),gr(e,1)):(e.moveTo(_.x,_.y),br(e,f,g,b,S,l),gr(e,i))}else gr(e,i)}class Pr extends Or{getHeight(e){return e*(this.options.options.height/100)}getSampleRenderProps(e,t,r,n){if(t>=e.length)return null;const o=e.getSample(t),{angularDelta:a,flipFrequencies:i,rotation:l,height:s,colorRgb:c,colorReaction:u,colorReactionValueProvider:d}=r,h=a/2+(i?e.length-1-t:t)*a;return{fillColor:this.computeFillColor(t,n,c,u,d),angle:[l-h,l+h],height:[o[0]*s,o[1]*s]}}renderSamples(e,t){if(void 0===e.samples)return;const r=this.options.options,n=e.samples.length,{canvasContext:o,visualizerAngle:a,x:i,y:l,radius:s}=t,c=r.thickness,u=r.smoothness,d=r.showMirrorWave,h=r.fill;let p=null;e.samples.forEach((r,v,g)=>{var f,b,m,y,w,O;const k=this.getSampleRenderProps(g,v,t,e);if(null===k)return;const{fillColor:_,angle:S,height:C}=k,j=[{height:C[0],angle:S[0]},{height:C[1],angle:S[1]}],x=this.getSampleRenderProps(g,v+1,t,e),R=null!==x?[{height:x.height[0],angle:x.angle[0]},{height:x.height[1],angle:x.angle[1]}]:null;var P,E;(o.save(),o.setFillColorRgb(_[0]),o.setStrokeColorRgb(_[0]),Rr(o,i,l,s,j[0].height,j[0].angle,c,u,d,h,null!==(f=null===(b=p)||void 0===b?void 0:b[0])&&void 0!==f?f:null,null!==(m=null==R?void 0:R[0])&&void 0!==m?m:null),_.length>0&&(o.setFillColorRgb(_[1]),o.setStrokeColorRgb(_[1])),Rr(o,i,l,s,j[1].height,j[1].angle,c,u,d,h,null!==(y=null===(w=p)||void 0===w?void 0:w[1])&&void 0!==y?y:null,null!==(O=null==R?void 0:R[1])&&void 0!==O?O:null),p=j,0===v||v===n-1&&360===a)&&(Rr(o,i,l,s,j[0].height,j[0].angle,c,u,d,h,j[1],null!==(P=null==R?void 0:R[0])&&void 0!==P?P:null),Rr(o,i,l,s,j[1].height,j[1].angle,c,u,d,h,j[0],null!==(E=null==R?void 0:R[1])&&void 0!==E?E:null));o.restore()})}}function Er(e,t,r,n,o){const a=n;let i;switch(o){case cr.a.Bars:i=new Sr(e,t,{visualizerOptions:r,get commonOptions(){return a.current},get options(){return a.current.bars}});break;case cr.a.Blocks:i=new jr(e,t,{visualizerOptions:r,get commonOptions(){return a.current},get options(){return a.current.blocks}});break;case cr.a.Wave:i=new Pr(e,t,{visualizerOptions:r,get commonOptions(){return a.current},get options(){return a.current.wave}})}return void 0===i?()=>null:i.render.bind(i)}const Tr=g.a.getLogger("Visualizer","darkblue");function Mr(){const e=Object(p.useMemo)(()=>"Visualizer-"+(Math.random()*10**6).toFixed(6),[]),t=Object(p.useContext)(k),r=Object(p.useRef)(t.wallpaperProperties.visualizer),n=Object(p.useRef)(t.wallpaperProperties.verticalVisualizer),o=Object(p.useRef)(t.wallpaperProperties.circularVisualizer),[a,i]=Object(p.useState)(r.current.type);J(e=>e.visualizer,e=>{void 0!==e.type&&i(e.type)},[]);const l=Object(p.useRef)(null);Object(p.useEffect)(()=>{Tr.info("Initializing canvas..."),l.current.width=window.innerWidth,l.current.height=window.innerHeight},[]);const c=Object(p.useMemo)(()=>{switch(a){case cr.c.VerticalBars:return wr(t,l,r,n,cr.b.Bars);case cr.c.VerticalBlocks:return wr(t,l,r,n,cr.b.Blocks);case cr.c.VerticalWave:return wr(t,l,r,n,cr.b.Wave);case cr.c.CircularBars:return Er(t,l,r,o,cr.a.Bars);case cr.c.CircularBlocks:return Er(t,l,r,o,cr.a.Blocks);case cr.c.CircularWave:return Er(t,l,r,o,cr.a.Wave);default:return e=>null}},[t,a]);return Object(p.useEffect)(()=>{var n,o;Tr.info("Registering onAudioSamples and render callbacks..."),null===(n=l.current)||void 0===n||null===(o=n.getContext("2d"))||void 0===o||o.clearRect(0,0,l.current.width,l.current.height);let a,i,u,d=1,h=0;const p=n=>{var o,p;a=n.samplesBuffer,n.peak>1&&g.a.warn("Current peak > 1!",{peak:n.peak,samples:n.samples.raw});const v=r.current.smoothing/100,f=a.size>1?((e,t)=>{let r=0;return e.reduce((e,n,o,a)=>{const i=o/(a.length-1),l=a.length>1&&i<1?6**((i-1)/t):1;return r+=l,n.raw.forEach((t,r)=>{var n;e[r]=(null!==(n=e[r])&&void 0!==n?n:0)+t*l}),e},[]).map(e=>e/r)})(a.raw,v):void 0!==u&&1===a.size?((e,t,r)=>{const n=t.raw,o=.35*r;return e.raw.map((e,t)=>Math.lerp(n[t],e,1-o))})(n.samples,u,v):n.samples.raw,m=null!==(o=s()(f))&&void 0!==o?o:0;m>1&&f.forEach((e,t)=>{f[t]/=m}),d=null!==(p=s()(f))&&void 0!==p?p:0,i=new b(f,2),++h>=2&&(u=n.samples,h=0);const y={samplesBuffer:a,samples:i,peak:d};t.renderer.queue(e,()=>{const e=c(y);t.pluginManager.processAudioData(y),null!==l.current&&null!==e&&t.pluginManager.processVisualizerSamplesData(e)})};return null==t||t.wallpaperEvents.onAudioSamples.subscribe(p),()=>{null==t||t.renderer.cancel(e),null==t||t.wallpaperEvents.onAudioSamples.unsubscribe(p)}},[e,t,c]),v.a.createElement("canvas",{ref:l})}function zr(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Ir(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Br(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Lr=g.a.getLogger("App","darkgreen");function Ar(e){const t=Object(p.useRef)(e.options),[r,n]=Object(p.useState)(t.current.showStats),[a,l]=Object(p.useState)(t.current.spotify.showOverlay),[c,d]=Object(p.useState)(t.current.clock.enabled),[g,f]=Object(p.useState)(!1),[_,x]=Object(p.useState)(t.current.icuePlugin.enabled);window.acav.getProperties=function(){return h()(t.current)};const R=Object(p.useMemo)(()=>new Set,[]),P=Object(p.useMemo)(()=>new Set,[]),E=Object(p.useMemo)(()=>new Set,[]),T=Object(p.useMemo)(()=>({onUserPropertiesChanged:{subscribe:e=>{R.add(e)},unsubscribe:e=>{R.delete(e)}},onGeneralPropertiesChanged:{subscribe:e=>{P.add(e)},unsubscribe:e=>{P.delete(e)}},onAudioSamples:{subscribe:e=>{E.add(e)},unsubscribe:e=>{E.delete(e)}}}),[R,P,E]),z=function(e){const t=Object(p.useMemo)(()=>S(e),[e]);return Object(p.useEffect)(()=>(t.start(),()=>t.stop()),[t]),t}(),I=Object(p.useMemo)(()=>(Lr.info("Creating WallpaperContext..."),{windowEvents:e.windowEvents,wallpaperEvents:T,wallpaperProperties:t.current,renderer:z,pluginManager:new M}),[e.windowEvents,T,z]),B=Object(p.useRef)(0),L=Object(p.useMemo)(()=>{var e;return new m(null!==(e=1+t.current.audioSamples.bufferLength)&&void 0!==e?e:0)},[]);Object(p.useEffect)(()=>(window.wallpaperPropertyListener={},window.wallpaperPluginListener={onPluginLoaded:e=>{"cue"===e&&f(!0)}},()=>{delete window.wallpaperPropertyListener,delete window.wallpaperPluginListener,f(!1)}),[]);const{styleBackground:A,updateBackground:N,scheduleBackgroundImageChange:V}=function(e){const t=e.options,[r,n]=Object(p.useState)({}),o=Object(p.useRef)(void 0),a=Object(p.useRef)(0),i=Object(p.useCallback)((e,t)=>{clearTimeout(a.current),a.current=setTimeout(()=>e(),t),j.debug(`Scheduled background image change in ${t/1e3}s.`)},[]),l=Object(p.useCallback)(t=>{t?t!==o.current&&(o.current=t,window.localStorage.setItem(e.localStorageKeys.currentImage,t),n(Object(C.b)(C.a.Image,{imagePath:t})),j.debug(`Background image set to "${t}"`)):n({})},[e.localStorageKeys.currentImage]),s=Object(p.useRef)(""),c=Object(p.useCallback)((r=3)=>{s.current=(Math.random()*10**8).toFixed(0);const n=t.current.background.playlistDirectory;if(n&&n.length>0){const a=s.current;window.wallpaperRequestRandomFileForProperty("background_playlist",(u,d)=>{j.debug("Got new image from wallpaperRequestRandomFileForProperty:",`"${d}"`),t.current.background.mode!==C.a.Playlist||t.current.background.playlistDirectory!==n||a!==s.current||((!d||d===o.current)&&r>0?c(r-1):(l(d),window.localStorage.setItem(e.localStorageKeys.playlistTimer,Date.now().toString()),i(c,60*t.current.background.playlistTimerMinutes*1e3)))})}},[t,e.localStorageKeys.playlistTimer,i,l]),u=Object(p.useRef)(!0),d=Object(p.useCallback)(()=>{function r(){o.current=null,window.localStorage.removeItem(e.localStorageKeys.currentImage),window.localStorage.removeItem(e.localStorageKeys.playlistTimer),clearTimeout(a.current)}if(j.debug("Updating background...",{firstUpdate:u.current,background:h()(t.current.background)}),t.current.background.mode===C.a.Playlist){const o=window.localStorage.getItem(e.localStorageKeys.playlistTimer);if(o&&u.current){const e=Date.now()-Number(o);if(e>=60*t.current.background.playlistTimerMinutes*1e3)c();else{const r=60*t.current.background.playlistTimerMinutes*1e3-e;i(c,r)}}else t.current.background.playlistDirectory?c():(r(),n({}))}else if(r(),t.current.background.mode===C.a.Color){var s;const e=null!==(s=t.current.background.color)&&void 0!==s?s:[0,0,0];n(Object(C.b)(C.a.Color,{color:e}))}else t.current.background.mode===C.a.Image?l(t.current.background.imagePath):t.current.background.mode===C.a.Css&&n(Object(C.b)(C.a.Css,{css:t.current.background.css}));u.current=!1},[t,c,e.localStorageKeys.currentImage,e.localStorageKeys.playlistTimer,i,l]);return Object(p.useEffect)(()=>{const t=window.localStorage.getItem(e.localStorageKeys.currentImage);t&&t.length>0&&l(t)},[e.localStorageKeys.currentImage,l]),{styleBackground:r,updateBackground:d,scheduleBackgroundImageChange:Object(p.useCallback)(e=>i(c,e),[i,c])}}({localStorageKeys:{currentImage:"aleab.acav.bgCurrentImage",playlistTimer:"aleab.acav.bgPlaylistImageChangedTime"},options:t}),D=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ir(Object(r),!0).forEach((function(t){Br(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ir(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},A);var F,$,H,G;Object(p.useEffect)(()=>(Lr.info("Registering general properties callback..."),window.wallpaperPropertyListener.applyGeneralProperties=e=>{const r=h()(e);u()(r)||(Lr.debug("General properties applied",r),void 0!==r.fps&&(B.current=r.fps,t.current.limitFps&&z.setFps(B.current)),P.forEach(e=>e({newProps:r})))},()=>{var e;null===(e=window.wallpaperPropertyListener)||void 0===e||delete e.applyGeneralProperties}),[P,z]),Object(p.useEffect)(()=>(Lr.info("Registering user properties callback..."),window.wallpaperPropertyListener.applyUserProperties=e=>{var r;const o=h()(t.current),a=Object(y.a)(t.current,e);if(!u()(a)){if(Lr.debug("User properties applied",a),void 0!==a.showStats&&n(a.showStats),void 0!==a.limitFps&&z.setFps(a.limitFps?B.current:0),void 0!==a.background){const e=a.background,{playlistTimerMinutes:t}=e,r=zr(e,["playlistTimerMinutes"]);if(u()(r)){if(t){var i;const e=Number(null!==(i=window.localStorage.getItem("aleab.acav.bgPlaylistImageChangedTime"))&&void 0!==i?i:"0"),r=60*t*1e3-(Date.now()-e);V(r>=0?r:0)}}else N()}void 0!==(null===(r=a.audioSamples)||void 0===r?void 0:r.bufferLength)&&L.resize(1+a.audioSamples.bufferLength),void 0!==a.clock&&void 0!==a.clock.enabled&&d(a.clock.enabled),void 0!==a.spotify&&void 0!==a.spotify.showOverlay&&l(a.spotify.showOverlay),void 0!==a.icuePlugin&&void 0!==a.icuePlugin.enabled&&x(a.icuePlugin.enabled),R.forEach(e=>e({oldProps:o,newProps:a}))}},()=>{var e;null===(e=window.wallpaperPropertyListener)||void 0===e||delete e.applyUserProperties}),[R,z,L,V,N]),F=I.pluginManager,$="cue",H=_&&g,G={getOptions:()=>t.current.icuePlugin},Object(p.useEffect)(()=>(H&&F.enable($,G),()=>{F.disable($)}),[G,H,F,$]),Object(p.useEffect)(()=>{Lr.info("Registering wallpaperRegisterAudioListener callback...");let e=0,r=0;let n,a=!1;window.acav.togglePauseAudioListener=function(){a=!a};const l=l=>{if(a||(n=new b(function(n){var a,l;const c=t.current.audioSamples.correctSamples,u=O.b.buildScaleFunction(t.current.audioSamples.scale),d=n.map((e,r)=>{let n=e;return c&&(n/=w[r%w.length]),n*=1+t.current.audioSamples.audioVolumeGain/100,n=n>=t.current.audioSamples.audioFreqThreshold/1e3?n:0,n=u(n),n});if(e=null!==(a=s()(d))&&void 0!==a?a:0,t.current.audioSamples.normalize){let t=1;const r=L.raw.map((e,r,n)=>{const o=6**(r/n.length-1);return t+=o,e.max()*o}).concat(e);e=i()(r)/t,e>0&&d.forEach((t,r)=>{d[r]/=e})}return r=null!==(l=o()(d))&&void 0!==l?l:0,d}(l),2),L.push(n)),void 0!==n){const t={rawSamples:new b(l,2),samples:n,samplesBuffer:L,peak:e,mean:r};E.forEach(e=>e(t))}};return window.wallpaperRegisterAudioListener(l),window.acav.resetAudioListener=function(){window.wallpaperRegisterAudioListener(l)},()=>{window.wallpaperRegisterAudioListener(null),delete window.acav.togglePauseAudioListener}},[E,L,I.pluginManager]);const U=Object(p.useRef)(null);return v.a.createElement("div",{ref:U,style:D},v.a.createElement(k.Provider,{value:I},r?v.a.createElement(W,null):null,v.a.createElement(Mr,null),a?v.a.createElement(sr,{backgroundElement:U}):null,c?v.a.createElement(ue,null):null))}},15:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"b",(function(){return u}));var n=r(197),o=r.n(n),a=r(5),i=r.n(a);function l(e){let t=[255,255,255,1];if("transparent"===e)return[0,0,0,0];if("currentcolor"===e)return;const r=i.a.keyword.rgb(e);if(r)t=[r[0],r[1],r[2],1];else if(e.startsWith("#")){const r=i.a.hex.rgb(e);t=[r[0],r[1],r[2],255]}else if(e.startsWith("rgb")){var n;const r=e.replace(/^.*rgba?\((.+?)\).*$/,"$1").split(/\s|,|\//).filter(e=>/[0-9]/.test(e)).map((e,t)=>{if(e.includes("%")){const r=Number(e.replace("%",""))/100;return t<=2?255*r:r}return Number(e)});t=[r[0],r[1],r[2],null!==(n=r[3])&&void 0!==n?n:1]}else{if(!e.startsWith("hsl"))throw new Error(`Unknown CSS color format: '${e}'`);{const r=e.replace(/^hsla?\((.+?)\)$/,"$1").split(/\s|,|\//).filter(e=>/[0-9]/.test(e)).map((e,t)=>{if(e.includes("%")){const r=Number(e.replace("%",""))/100;return t<=2?255*r:r}return Number(e)}),n=i.a.hsl.rgb(r);t=[n[0],n[1],n[2],r[3]]}}return t}function s(e,t){return void 0===t||o()(t,t=>"string"==typeof t?t.toLowerCase()===e.toLowerCase():t.test(e))}function c(e,t,r=!0){const n=/([\w-]+)\s*:\s*((['"]).*\3|[^;]*)/g,o={};let a;for(;null!==(a=n.exec(e));)if(s(a[1],t)){const e=r?a[1].replace(/-(.)/g,(e,t)=>t.toUpperCase()):a[1];e&&(o[e]=a[2])}return o}function u(e){if(null===e)return null;const{backgroundClip:t,backgroundColor:r,backgroundImage:n,backgroundOrigin:o,backgroundPosition:a,backgroundRepeat:i,backgroundSize:l}=getComputedStyle(e);return{backgroundClip:t,backgroundColor:r,backgroundImage:n,backgroundOrigin:o,backgroundPosition:a,backgroundRepeat:i,backgroundSize:l}}},17:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));var n=r(15);let o;function a(e,t){switch(e){case o.Color:return t.color?{backgroundColor:void 0===t.alpha||1===t.alpha?`rgb(${t.color[0]}, ${t.color[1]}, ${t.color[2]})`:`rgba(${t.color[0]}, ${t.color[1]}, ${t.color[2]}, ${t.alpha})`}:{};case o.Playlist:case o.Image:return{background:`center / cover no-repeat url("file:///${t.imagePath}")`};case o.Css:return t.css?Object(n.c)(t.css,[/^background(-[a-z]+)?/]):{};default:return{}}}!function(e){e[e.Color=0]="Color",e[e.Image=1]="Image",e[e.Css=2]="Css",e[e.Playlist=3]="Playlist"}(o||(o={}))},211:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(14),o=r.n(n);function a(e,t){const r=[o()({},e,{audioSamples_volumeGain:{value:35},audioSamples_scale:{value:"Logarithm"},audioSamples_scale_Logarithm_base:{value:2.2},visualizer_type:{value:"VerticalBars"},visualizer_color_responseType:{value:"HslLightness"},visualizer_color_responseProvider:{value:"ValueNormalized"},visualizer_color_responseValueGain:{value:1},visualizer_color_responseRange:{value:35},visualizer_color_responseDegree:{value:.8},verticalVisualizer_width:{value:45},verticalVisualizer_alignment:{value:0},verticalVisualizer_color:{value:"0.176470 0.266667 0.611764"},verticalVisualizer_bars_width:{value:60},verticalVisualizer_bars_height:{value:40},verticalVisualizer_bars_borderRadius:{value:0},spotify:{value:!1}}),o()({},e,{audioSamples_volumeGain:{value:30},audioSamples_scale:{value:"Logarithm"},audioSamples_scale_Logarithm_base:{value:2.2},visualizer_type:{value:"VerticalWave"},visualizer_color_responseType:{value:"LabLightness"},visualizer_color_responseProvider:{value:"ValueNormalized"},visualizer_color_responseValueGain:{value:1},visualizer_color_responseRange:{value:35},visualizer_color_responseDegree:{value:.8},verticalVisualizer_width:{value:45},verticalVisualizer_alignment:{value:0},verticalVisualizer_color:{value:"0.8666666666666667 0.5725490196078431 0"},verticalVisualizer_wave_height:{value:35},verticalVisualizer_wave_thickness:{value:2},verticalVisualizer_wave_showMirrorWave:{value:!0},verticalVisualizer_wave_fill:{value:!1},spotify:{value:!1}}),o()({},e,{audioSamples_volumeGain:{value:35},audioSamples_scale:{value:"Gaussian"},visualizer_type:{value:"CircularWave"},visualizer_color_responseType:{value:"LabB"},visualizer_color_responseProvider:{value:"ValueNormalized"},visualizer_color_responseValueGain:{value:1},visualizer_color_responseRange:{value:50},visualizer_color_responseDegree:{value:.8},circularVisualizer_radius:{value:22},circularVisualizer_color:{value:"0.596078431372549 0.6313725490196078 0.45098039215686275"},circularVisualizer_wave_height:{value:65},circularVisualizer_wave_showMirrorWave:{value:!0},circularVisualizer_wave_fill:{value:!0},spotify:{value:!1}}),o()({},e,{audioSamples_volumeGain:{value:35},audioSamples_scale:{value:"Gaussian"},visualizer_type:{value:"CircularBlocks"},visualizer_color_responseType:{value:"LabA"},visualizer_color_responseProvider:{value:"Change"},visualizer_color_responseValueGain:{value:4.5},visualizer_color_responseRange:{value:50},visualizer_color_responseDegree:{value:1.4},circularVisualizer_radius:{value:22},circularVisualizer_color:{value:"0.3137254901960784 0.3215686274509804 0.6823529411764706"},circularVisualizer_blocks_width:{value:100},circularVisualizer_blocks_height:{value:75},circularVisualizer_blocks_thickness:{value:5},spotify:{value:!1}})],n=e=>{e>=r.length||void 0!==window.wallpaperPropertyListener&&void 0!==window.wallpaperPropertyListener.applyUserProperties&&(console.log("%c===| Preview %d","color: #350E23; font-weight:bold",e),window.wallpaperPropertyListener.applyUserProperties(r[e]),setTimeout(()=>n(e+1),t))};n(0)}},213:function(e,t,r){"use strict";r.r(t),function(e){var t,n=r(0),o=r.n(n),a=r(58),i=r.n(a),l=(r(219),r(221),r(223),r(224),r(115)),s=r(77),c=r(211),u=r(114);r(405),r(406),r(407);function d(e){const t=new Set,r={onresize:{subscribe:e=>{t.add(e)},unsubscribe:e=>{t.delete(e)}}};window.onresize=()=>{t.forEach(e=>e({}))};const n=Object(s.b)(u),a=document.getElementById("root");window.acav.reload=function(){console.info('%c======================================================================\n LOADING WALLPAPER\n   NODE_ENV: "production"\n   APP_VERSION: "1.3.0"\n   BACKEND_API_BASEURL: "https://toastify.herokuapp.com/api/acav"\n======================================================================\n',"color: #350E23; font-weight:bold"),null!==a&&(i.a.unmountComponentAtNode(a),i.a.render(o.a.createElement(e,{options:n,windowEvents:r}),a))},window.acav.reload(),window.acav.startPreview=function(e){Object(c.a)(u,e)}}d(l.a),null===(t=e.hot)||void 0===t||t.accept("./components/App",()=>d(l.a))}.call(this,r(214)(e))},219:function(e,t,r){"use strict";r(220)},220:function(e,t){window.OffscreenCanvas||(window.OffscreenCanvas=class{constructor(e,t){return this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.canvas.convertToBlob=()=>new Promise(e=>{this.canvas.toBlob(e)}),this.canvas}})},221:function(e,t,r){"use strict";r(222);CanvasRenderingContext2D.prototype.setFillColorRgb=function(e){this.fillStyle=`rgb(${e[0]},${e[1]},${e[2]})`},CanvasRenderingContext2D.prototype.setStrokeColorRgb=function(e){this.strokeStyle=`rgb(${e[0]},${e[1]},${e[2]})`}},222:function(e,t){Math.PI_2=Math.PI/2,Math.clamp=(e,t,r)=>e>r?r:e<t?t:e,Math.lerp=(e,t,r)=>(1-r)*e+r*t,Math.median=(e,t=!1)=>{if(0===e.length)return 0;const r=t?e:e.slice().sort((e,t)=>e-t),n=Math.floor(r.length/2);return r.length%2?r[n]:(r[n-1]+r[n])/2},Math.formatBytes=(e,t=2)=>{if(0===e)return"0 B";const r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/1024**r).toFixed(t<0?0:t))+" "+["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][r]}},223:function(e,t,r){"use strict";var n=r(8);window.wallpaperRegisterAudioListener||(window.wallpaperRegisterAudioListener=e=>{}),n.a.debug=()=>{},n.a.info=()=>{},window.acav={}},224:function(e,t){window.acav.test=void 0},25:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return d}));var n=r(5),o=r.n(n),a=r(8);let i;function l(e){return e[0]===e[1]&&e[0]===e[2]}function s(e,t,r,n){return 0===n?r:n>0?r>t-n?t-n:r:r<e-n?e-n:r}function c(e,t){return Math.sign(e)*Math.abs(e)**(1/t)}!function(e){e[e.None=0]="None",e[e.Hue=1]="Hue",e[e.Saturation=2]="Saturation",e[e.HsvBrightness=3]="HsvBrightness",e[e.HslLightness=4]="HslLightness",e[e.LabLightness=5]="LabLightness",e[e.LabA=6]="LabA",e[e.LabB=7]="LabB"}(i||(i={}));const u={[i.None]:(e,{fromRgb:t})=>t,[i.Hue]:(e,{fromRgb:t,toRgb:r,degree:n})=>{if(l(t)||l(r))return t;const a=o.a.rgb.hsv(t),i=o.a.rgb.hsv(r),s=Math.clamp(Math.lerp(a[0],i[0],c(e,n)),0,360);return o.a.hsv.rgb([s,a[1],a[2]])},[i.Saturation]:(e,{fromRgb:t,degree:r,range:n})=>{if(l(t))return t;const a=o.a.rgb.hsv(t),i=s(0,100,a[1],Math.sign(e)*n),u=Math.clamp(i+n*c(e,r),0,100);return o.a.hsv.rgb([a[0],u,a[2]])},[i.HsvBrightness]:(e,{fromRgb:t,degree:r,range:n})=>{const a=o.a.rgb.hsv(t),i=s(0,100,a[2],Math.sign(e)*n),l=Math.clamp(i+n*c(e,r),0,100);return o.a.hsv.rgb([a[0],a[1],l])},[i.HslLightness]:(e,{fromRgb:t,degree:r,range:n})=>{const a=o.a.rgb.hsl(t),i=s(0,100,a[2],Math.sign(e)*n),l=Math.clamp(i+n*c(e,r),0,100);return o.a.hsl.rgb([a[0],a[1],l])},[i.LabLightness]:(e,{fromRgb:t,degree:r,range:n})=>{const a=o.a.rgb.lab(t),i=s(0,100,a[0],Math.sign(e)*n),l=Math.clamp(i+n*c(e,r),0,100);return o.a.lab.rgb([l,a[1],a[2]])},[i.LabA]:(e,{fromRgb:t,degree:r,range:n})=>{const a=o.a.rgb.lab(t),i=s(-128,127,a[1],Math.sign(e)*n),l=Math.clamp(i+n*c(e,r),-128,127);return o.a.lab.rgb([a[0],l,a[2]])},[i.LabB]:(e,{fromRgb:t,degree:r,range:n})=>{const a=o.a.rgb.lab(t),i=s(-128,127,a[2],Math.sign(e)*n),l=Math.clamp(i+n*c(e,r),-128,127);return o.a.lab.rgb([a[0],a[1],l])}},d={buildColorReaction(e,t){let r=u[e];return r||(a.a.warn("Unhandled ColorReactionType:",i[e]),r=u[i.None]),e=>r(e,t)}}},32:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i}));var n=r(8);let o;!function(e){e[e.Value=0]="Value",e[e.ValueNormalized=1]="ValueNormalized",e[e.Change=2]="Change",e[e.ChangeAbsolute=3]="ChangeAbsolute"}(o||(o={}));const a={[o.Value]:(e,t,r)=>[Math.clamp(r*e[0],0,1),Math.clamp(r*e[1],0,1)],[o.ValueNormalized]:(e,t,r,{peak:n})=>{if(void 0===n)throw new Error("peak is undefined");return[Math.clamp(r*(e[0]/n),0,1),Math.clamp(r*(e[1]/n),0,1)]},[o.Change]:(e,t,r,{samplesBuffer:n})=>{var o;const a=null!==(o=null==n?void 0:n.get(0).getSample(t))&&void 0!==o?o:e;return[Math.clamp(r*(e[0]-a[0]),-1,1),Math.clamp(r*(e[1]-a[1]),-1,1)]},[o.ChangeAbsolute]:(e,t,r,{samplesBuffer:n})=>{var o;const a=null!==(o=null==n?void 0:n.get(0).getSample(t))&&void 0!==o?o:e;return[Math.clamp(r*Math.abs(e[0]-a[0]),0,1),Math.clamp(r*Math.abs(e[1]-a[1]),0,1)]}},i={buildAudioResponsiveValueProvider(e,t){let r=a[e];return r||(n.a.warn("Unhandled AudioResponsiveValueProvider type:",o[e]),r=a[o.Value]),(e,n,o)=>r(e,n,t,o)}}},33:function(e,t,r){"use strict";let n;r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),function(e){e[e.Center=0]="Center",e[e.Top=1]="Top",e[e.Left=2]="Left",e[e.Bottom=3]="Bottom",e[e.Right=4]="Right",e[e.TopLeft=5]="TopLeft",e[e.BottomLeft=6]="BottomLeft",e[e.BottomRight=7]="BottomRight",e[e.TopRight=8]="TopRight"}(n||(n={}));const o=new Map([[n.Center,[.5,.5]],[n.Top,[.5,0]],[n.Left,[0,.5]],[n.Bottom,[.5,1]],[n.Right,[1,.5]],[n.TopLeft,[0,0]],[n.BottomLeft,[0,1]],[n.BottomRight,[1,1]],[n.TopRight,[1,0]]]);function a(e){var t;const r=null!==(t=o.get(e))&&void 0!==t?t:[0,0];return{transform:`translate(${100*-r[0]}%, ${100*-r[1]}%)`}}},38:function(e,t,r){"use strict";let n;r.d(t,"a",(function(){return n})),function(e){e.OpenSans="Open Sans",e.Heebo="Heebo",e.Arapey="Arapey",e.LocalFont="LocalFont"}(n||(n={}))},405:function(e,t,r){},406:function(e,t,r){},407:function(e,t,r){},42:function(e,t,r){"use strict";let n;r.d(t,"a",(function(){return n})),function(e){e[e.Automatic=0]="Automatic",e[e.OnMouseOver=1]="OnMouseOver"}(n||(n={}))},59:function(e,t,r){"use strict";var n;!function(e){e[e.AlbumArt=0]="AlbumArt",e[e.SpotifyIcon=1]="SpotifyIcon"}(n||(n={})),t.a=n},77:function(e,t,r){"use strict";r.d(t,"b",(function(){return M})),r.d(t,"a",(function(){return z}));var n=r(28),o=r.n(n),a=r(21),i=r.n(a),l=r(196),s=r.n(l),c=r(56),u=r.n(c),d=r(14),h=r.n(d),p=r(9),v=r.n(p),g=r(33),f=r(78),b=r(32),m=r(17),y=r(25),w=r(38),O=r(79),k=r(59),_=r(42),S=r(11);function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x(e,t){return t[e.value]}function R(e){const t=e.value.split(" ").map(e=>Math.round(255*Number(e)));return[t[0],t[1],t[2]]}function P(e){return Math.clamp(e.value,e.min,e.max)}function E(e){return[e[0],e[1],e[2],255]}function T(e,t,r,n){void 0!==r&&(e[t]=n(r),void 0===e[t]&&delete e[t])}function M(e){const t={};T(t,"audioprocessing",e.audioprocessing,e=>null==e?void 0:e.value),T(t,"showStats",e.showStats,e=>e.value),T(t,"limitFps",e.limitFps,e=>e.value);const r={};T(r,"mode",e.background_type,e=>x(e,m.a)),T(r,"color",e.background_color,e=>R(e)),T(r,"imagePath",e.background_image,e=>e.value),T(r,"css",e.background_css,e=>e.value),T(r,"playlistDirectory",e.background_playlist,e=>e.value),T(r,"playlistTimerMinutes",e.background_playlistTimer,e=>Math.round(60*P(e)));const n={scale:{}};T(n,"correctSamples",e.audioSamples_correct,e=>e.value),T(n,"audioVolumeGain",e.audioSamples_volumeGain,e=>P(e)),T(n,"audioFreqThreshold",e.audioSamples_freqThreshold,e=>P(e)),T(n,"normalize",e.audioSamples_normalize,e=>e.value),T(n,"bufferLength",e.audioSamples_buffer,e=>Math.round(28*P(e))),T(n.scale,"function",e.audioSamples_scale,e=>x(e,O.a)),T(n.scale,"powExponent",e.audioSamples_scale_Power_exponent,e=>P(e)),T(n.scale,"expBase",e.audioSamples_scale_Exponential_base,e=>P(e)),T(n.scale,"logBase",e.audioSamples_scale_Logarithm_base,e=>P(e)),T(n.scale,"log$powA",e.audioSamples_scale_Logarithm$Power_a,e=>P(e)),T(n.scale,"log$powBase",e.audioSamples_scale_Logarithm$Power_base,e=>P(e)),T(n.scale,"log$powExponent",e.audioSamples_scale_Logarithm$Power_exponent,e=>P(e)),T(n.scale,"gaussianDeviation",e.audioSamples_scale_Gaussian_deviation,e=>P(e)),T(n.scale,"gaussianMean",e.audioSamples_scale_Gaussian_mean,e=>P(e)),v()(n.scale)&&delete n.scale;const o={};T(o,"type",e.visualizer_type,e=>x(e,S.c)),T(o,"flipFrequencies",e.visualizer_flipFrequencies,e=>e.value),T(o,"smoothing",e.visualizer_smoothing,e=>P(e)),T(o,"responseType",e.visualizer_color_responseType,e=>x(e,y.b)),T(o,"responseProvider",e.visualizer_color_responseProvider,e=>x(e,b.a)),T(o,"responseValueGain",e.visualizer_color_responseValueGain,e=>P(e)),T(o,"responseRange",e.visualizer_color_responseRange,e=>P(e)),T(o,"responseDegree",e.visualizer_color_responseDegree,e=>P(e)),T(o,"responseToHue",e.visualizer_color_response_toHue,e=>E(R(e)));const a={bars:{},blocks:{},wave:{}};T(a,"position",e.verticalVisualizer_position,e=>P(e)),T(a,"width",e.verticalVisualizer_width,e=>P(e)),T(a,"alignment",e.verticalVisualizer_alignment,e=>P(e)),T(a,"color",e.verticalVisualizer_color,e=>E(R(e))),T(a.bars,"width",e.verticalVisualizer_bars_width,e=>P(e)),T(a.bars,"height",e.verticalVisualizer_bars_height,e=>P(e)),T(a.bars,"borderRadius",e.verticalVisualizer_bars_borderRadius,e=>P(e)),v()(a.bars)&&delete a.bars,T(a.blocks,"width",e.verticalVisualizer_blocks_width,e=>P(e)),T(a.blocks,"height",e.verticalVisualizer_blocks_height,e=>P(e)),T(a.blocks,"thickness",e.verticalVisualizer_blocks_thickness,e=>P(e)),v()(a.blocks)&&delete a.blocks,T(a.wave,"height",e.verticalVisualizer_wave_height,e=>P(e)),T(a.wave,"thickness",e.verticalVisualizer_wave_thickness,e=>P(e)),T(a.wave,"smoothness",e.verticalVisualizer_wave_smoothness,e=>P(e)),T(a.wave,"showMirrorWave",e.verticalVisualizer_wave_showMirrorWave,e=>e.value),T(a.wave,"fill",e.verticalVisualizer_wave_fill,e=>e.value),v()(a.wave)&&delete a.wave;const i={bars:{},blocks:{},wave:{}};T(i,"x",e.circularVisualizer_x,e=>P(e)),T(i,"y",e.circularVisualizer_y,e=>P(e)),T(i,"radius",e.circularVisualizer_radius,e=>P(e)),T(i,"rotation",e.circularVisualizer_rotation,e=>P(e)),T(i,"angle",e.circularVisualizer_angle,e=>P(e)),T(i,"color",e.circularVisualizer_color,e=>E(R(e))),T(i.bars,"width",e.circularVisualizer_bars_width,e=>P(e)),T(i.bars,"height",e.circularVisualizer_bars_height,e=>P(e)),T(i.blocks,"width",e.circularVisualizer_blocks_width,e=>P(e)),T(i.blocks,"height",e.circularVisualizer_blocks_height,e=>P(e)),T(i.blocks,"thickness",e.circularVisualizer_blocks_thickness,e=>P(e)),v()(i.blocks)&&delete i.blocks,T(i.wave,"height",e.circularVisualizer_wave_height,e=>P(e)),T(i.wave,"thickness",e.circularVisualizer_wave_thickness,e=>P(e)),T(i.wave,"smoothness",e.circularVisualizer_wave_smoothness,e=>P(e)),T(i.wave,"showMirrorWave",e.circularVisualizer_wave_showMirrorWave,e=>e.value),T(i.wave,"fill",e.circularVisualizer_wave_fill,e=>e.value),v()(i.wave)&&delete i.wave;const l={digital:{}};T(l,"enabled",e.clock,e=>e.value),T(l,"pivot",e.clock_pivot,e=>x(e,g.a)),T(l,"left",e.clock_position_x,e=>P(e)),T(l,"top",e.clock_position_y,e=>P(e)),T(l,"customCss",e.clock_custom_css,e=>e.value),T(l,"showSeconds",e.clock_seconds,e=>e.value),T(l.digital,"font",e.clock_digital_font,e=>x(e,w.a)),T(l.digital,"fontSize",e.clock_digital_fontsize,e=>P(e)),T(l.digital,"textColor",e.clock_digital_text_color,e=>R(e)),T(l.digital,"locale",e.clock_digital_locale,e=>e.value),T(l.digital,"is24h",e.clock_digital_24h,e=>e.value),v()(l.digital)&&delete l.digital;const s={style:{background:{}},art:{},scroll:{},progressBar:{}};T(s,"showOverlay",e.spotify,e=>e.value),T(s,"backendURL",e.spotify_backend_url,e=>e.value),T(s,"token",e.spotify_token,e=>e.value),T(s.style,"pivot",e.spotify_pivot,e=>x(e,g.a)),T(s.style,"left",e.spotify_position_x,e=>P(e)),T(s.style,"top",e.spotify_position_y,e=>P(e)),T(s.style,"width",e.spotify_width,e=>P(e)),T(s.style,"fontSize",e.spotify_font_size,e=>P(e)),T(s.style,"textColor",e.spotify_text_color,e=>R(e)),T(s.style.background,"mode",e.spotify_background_type,e=>x(e,m.a)),T(s.style.background,"color",e.spotify_background_color,e=>R(e)),T(s.style.background,"colorAlpha",e.spotify_background_color_alpha,e=>P(e)),T(s.style.background,"css",e.spotify_background_css,e=>e.value),v()(s.style.background)&&delete s.style.background,v()(s.style)&&delete s.style,T(s.art,"enabled",e.spotify_art,e=>e.value),T(s.art,"type",e.spotify_art_type,e=>x(e,k.a)),T(s.art,"fetchLocalCovers",e.spotify_art_fetch_local,e=>e.value),T(s.art,"fetchLocalCacheMaxAge",e.spotify_art_fetch_local_cache_age,e=>P(e)),v()(s.art)&&delete s.art,T(s.scroll,"enabled",e.spotify_scroll,e=>e.value),T(s.scroll,"type",e.spotify_scroll_type,e=>x(e,_.a)),T(s.scroll,"speed",e.spotify_scroll_speed,e=>P(e)),T(s.scroll,"autoDelay",e.spotify_scroll_auto_delay,e=>P(e)),v()(s.scroll)&&delete s.scroll,T(s.progressBar,"enabled",e.spotify_progressbar,e=>e.value),T(s.progressBar,"color",e.spotify_progressbar_color,e=>R(e)),T(s.progressBar,"position",e.spotify_progressbar_position,e=>x(e,f.a)),v()(s.progressBar)&&delete s.progressBar;const c={};return T(c,"enabled",e.icue,e=>e.value),T(c,"boost",e.icue_boost,e=>P(e)),T(c,"spectrumStart",e.icue_spectrum_start,e=>P(e)),T(c,"spectrumWidth",e.icue_spectrum_width,e=>P(e)),h()(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t),v()(r)?{}:{background:r},v()(n)?{}:{audioSamples:n},v()(o)?{}:{visualizer:o},v()(a)?{}:{verticalVisualizer:a},v()(i)?{}:{circularVisualizer:i},v()(l)?{}:{clock:l},v()(s)?{}:{spotify:s},v()(c)?{}:{icuePlugin:c})}function z(e,t){const r=M(t);return function e(t,r){Object.keys(r).forEach(n=>{u()(r[n])?s()(r[n],t[n])&&delete r[n]:void 0!==t[n]&&i()(r[n])?(e(t[n],r[n]),v()(r[n])&&delete r[n]):t[n]===r[n]&&delete r[n]})}(e,r),h()(e,r),o()(r)}},78:function(e,t,r){"use strict";let n;r.d(t,"a",(function(){return n})),function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.Left=2]="Left",e[e.Right=3]="Right"}(n||(n={}))},79:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i}));var n=r(8);let o;function a(e,t){return Math.abs(Math.log(t)/Math.log(e))}!function(e){e[e.Linear=0]="Linear",e[e.Power=1]="Power",e[e.Exponential=2]="Exponential",e[e.Logarithm=3]="Logarithm",e[e.Logarithm$Power=4]="Logarithm$Power",e[e.Gaussian=5]="Gaussian",e[e.Gaussian$Power=6]="Gaussian$Power"}(o||(o={}));const i={buildScaleFunction(e){switch(e.function){case o.Linear:return e=>Math.abs(e);case o.Power:return t=>Math.abs(t)**e.powExponent;case o.Exponential:return t=>e.expBase**t-1;case o.Logarithm:return t=>a(e.logBase,t+1);case o.Logarithm$Power:return t=>e.log$powA*a(e.log$powBase,t+1)+(1-e.log$powA)*Math.abs(t)**e.log$powExponent;case o.Gaussian:return t=>{const r=(n=e.gaussianDeviation,o=e.gaussianMean,e=>1/(n*Math.sqrt(2*Math.PI))*Math.exp(-.5*((e-o)/n)**2));var n,o;return r(t)-r(0)};default:return n.a.warn("Unhandled scale function type:",o[e.function]),this.buildScaleFunction(e)}}}},8:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));class n{static getLogger(e,t,r){const o="color:"+t+(r?";"+r:""),a=e?[`%c[${e}] %c%s`,o+";font-weight:bold",o]:["%c%s",o];return{debug:n.debug.bind(null,...a),info:n.info.bind(null,...a),warn:n.warn.bind(null,...a),error:n.error.bind(null,...a)}}}n.debug=console.debug,n.info=console.info,n.warn=console.warn,n.error=console.error}});